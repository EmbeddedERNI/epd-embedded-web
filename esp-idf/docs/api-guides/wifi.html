

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wi-Fi Driver &mdash; ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation" href="../index.html"/>
        <link rel="up" title="API Guides" href="index.html"/>
        <link rel="next" title="Support for external RAM" href="external-ram.html"/>
        <link rel="prev" title="ESP32 ROM console" href="romconsole.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
          </a>

          
            
            
              <div class="version">
                v3.0-dev-806-gde750e9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="wifi.html#">WiFi Driver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#important-notes">Important Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-feature-list">ESP32 Wi-Fi Feature List</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#how-to-write-a-wi-fi-application">How To Write a Wi-Fi Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#preparation">Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#setting-wi-fi-compile-time-options">Setting Wi-Fi Compile-time Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#init-wi-fi">Init Wi-Fi</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#start-connect-wi-fi">Start/Connect Wi-Fi</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#event-handling">Event-Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#write-error-recovery-routines-correctly-at-all-times">Write Error-Recovery Routines Correctly at All Times</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-api-error-code">ESP32 Wi-Fi API Error Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-programming-model">ESP32 Wi-Fi Programming Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-event-description">ESP32 Wi-Fi Event Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-wifi-ready">SYSTEM_EVENT_WIFI_READY</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-scan-done">SYSTEM_EVENT_SCAN_DONE</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-stop">SYSTEM_EVENT_STA_STOP</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-connected">SYSTEM_EVENT_STA_CONNECTED</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-authmode-change">SYSTEM_EVENT_STA_AUTHMODE_CHANGE</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-sta-got-ip">SYSTEM_EVENT_STA_GOT_IP</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-sta-got-ip6">SYSTEM_EVENT_AP_STA_GOT_IP6</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-start">SYSTEM_EVENT_AP_START</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-stop">SYSTEM_EVENT_AP_STOP</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-staconnected">SYSTEM_EVENT_AP_STACONNECTED</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-stadisconnected">SYSTEM_EVENT_AP_STADISCONNECTED</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#system-event-ap-probereqrecved">SYSTEM_EVENT_AP_PROBEREQRECVED</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-station-general-scenario">ESP32 Wi-Fi Station General Scenario</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-lwip-init-phase">1. Wi-Fi/LwIP Init Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-configuration-phase">2. Wi-Fi Configuration Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-start-phase">3. Wi-Fi Start Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-connect-phase">4. Wi-Fi Connect Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-got-ip-phase">5. Wi-Fi &#8216;Got IP&#8217; Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-disconnect-phase">6. Wi-Fi Disconnect Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-ip-change-phase">7. Wi-Fi IP Change Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-deinit-phase">8. Wi-Fi Deinit Phase</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-soft-ap-general-scenario">ESP32 Wi-Fi soft-AP General Scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-scan">ESP32 Wi-Fi Scan</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-type">Scan Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-configuration">Scan Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-all-aps-in-all-channels-foreground">Scan All APs In All Channels(foreground)</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-all-aps-on-all-channels-background">Scan All APs on All Channels(background)</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-for-a-specific-ap-in-all-channels">Scan for a Specific AP in All Channels</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-in-wi-fi-connect">Scan in Wi-Fi Connect</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-in-blocked-mode">Scan In Blocked Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#parallel-scan">Parallel Scan</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-station-connecting-scenario">ESP32 Wi-Fi Station Connecting Scenario</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#scan-phase">Scan Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#auth-phase">Auth Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#association-phase">Association Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#four-way-handshake-phase">Four-way Handshake Phase</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-configuration">ESP32 Wi-Fi Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-mode">Wi-Fi Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#station-basic-configuration">Station Basic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#soft-ap-basic-configuration">Soft-AP Basic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-protocol-mode">Wi-Fi Protocol Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-channel-management">Wi-Fi Channel Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-vendor-ie-configuration">Wi-Fi Vendor IE Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-power-saving-mode">ESP32 Wi-Fi Power-saving Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-connect-crypto">ESP32 Wi-Fi Connect Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#esp32-wi-fi-throughput">ESP32 Wi-Fi Throughput</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#wi-fi-80211-packet-send">Wi-Fi 80211 Packet Send</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#parameters-of-esp-wifi-80211-tx">Parameters of esp_wifi_80211_tx</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#preconditions-of-using-esp-wifi-80211-tx">Preconditions of Using esp_wifi_80211_tx</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#side-effects-to-avoid-in-different-scenarios">Side-Effects to Avoid in Different Scenarios</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#wi-fi-sniffer-mode">Wi-Fi Sniffer Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#wi-fi-buffer-usage">Wi-Fi Buffer Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#why-buffer-configuration-is-important">Why Buffer Configuration Is Important</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#dynamic-vs-static-buffer">Dynamic vs. Static Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#peak-lwip-dynamic-buffer">Peak LwIP Dynamic Buffer</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#peak-wi-fi-dynamic-buffer">Peak Wi-Fi Dynamic Buffer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wifi.html#wi-fi-menuconfig">Wi-Fi Menuconfig</a><ul>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-buffer-configure">Wi-Fi Buffer Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-nvs-flash">Wi-Fi NVS Flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="wifi.html#wi-fi-ampdu">Wi-Fi AMPDU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>Wi-Fi Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api-guides/wifi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wi-fi-driver">
<h1>Wi-Fi Driver<a class="headerlink" href="wifi.html#wi-fi-driver" title="Permalink to this headline">¶</a></h1>
<div class="section" id="important-notes">
<h2>Important Notes<a class="headerlink" href="wifi.html#important-notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>This document describes the implementation of only the <strong>latest</strong> IDF release. Backward compatibility with older versions of ESP-IDF is not guaranteed.</li>
<li>This document describes the features which have already been implemented in the <strong>latest</strong> IDF release. For  features that are now in developing/testing status, we also provide brief descriptions, while indicating the release versions in which these features will be eventually implemented.</li>
<li>If you find anything wrong/ambiguous/hard to understand or inconsistent with the implementation, feel free to let us know about it on our IDF GitHub page.</li>
</ul>
</div>
<div class="section" id="esp32-wi-fi-feature-list">
<h2>ESP32 Wi-Fi Feature List<a class="headerlink" href="wifi.html#esp32-wi-fi-feature-list" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Supports Station-only mode, SoftAP-only mode, Station/SoftAP-coexistence mode</li>
<li>Supports IEEE-802.11B, IEEE-802.11G, IEEE802.11N and APIs to configure the protocol mode</li>
<li>Supports WPA/WPA2/WPA2-Enterprise and WPS</li>
<li>Supports AMPDU, HT40, QoS and other key features</li>
<li>Supports Modem-sleep</li>
<li>Supports an Espressif-specific protocol which, in turn, supports up to <strong>1 km</strong> of data traffic</li>
<li>Up to 20 MBit/sec TCP throughput and 30 MBit/sec UDP throughput over the air</li>
<li>Supports Sniffer</li>
<li>Support set fast_crypto algorithm and normal algorithm switch which used in wifi connect</li>
</ul>
</div>
<div class="section" id="how-to-write-a-wi-fi-application">
<h2>How To Write a Wi-Fi Application<a class="headerlink" href="wifi.html#how-to-write-a-wi-fi-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="preparation">
<h3>Preparation<a class="headerlink" href="wifi.html#preparation" title="Permalink to this headline">¶</a></h3>
<p>Generally, the most effective way to begin your own Wi-Fi application is to select an example which is similar to your own application, and port the useful part into your project. It is not a MUST but it is strongly recommended that you take some time to read this article first, especially if you want to program a robust Wi-Fi application. This article is supplementary to the Wi-Fi APIs/Examples. It describes the principles of using the Wi-Fi APIs, the limitations of the current Wi-Fi API implementation, and the most common pitfalls in using Wi-Fi. This article also reveals some design details of the Wi-Fi driver. We recommend that you become familiar at least with the following sections: &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-api-error-code">ESP32 Wi-Fi API Error Code</a>&gt;, &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-programming-model">ESP32 Wi-Fi Programming Model</a>&gt;, and &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-event-description">ESP32 Wi-Fi Event Description</a>&gt;.</p>
</div>
<div class="section" id="setting-wi-fi-compile-time-options">
<h3>Setting Wi-Fi Compile-time Options<a class="headerlink" href="wifi.html#setting-wi-fi-compile-time-options" title="Permalink to this headline">¶</a></h3>
<p>Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-menuconfig">Wi-Fi Menuconfig</a>&gt;</p>
</div>
<div class="section" id="init-wi-fi">
<h3>Init Wi-Fi<a class="headerlink" href="wifi.html#init-wi-fi" title="Permalink to this headline">¶</a></h3>
<p>Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-station-general-scenario">ESP32 Wi-Fi Station General Scenario</a>&gt;, &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-soft-ap-general-scenario">ESP32 Wi-Fi soft-AP General Scenario</a>&gt;.</p>
</div>
<div class="section" id="start-connect-wi-fi">
<h3>Start/Connect Wi-Fi<a class="headerlink" href="wifi.html#start-connect-wi-fi" title="Permalink to this headline">¶</a></h3>
<p>Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-station-general-scenario">ESP32 Wi-Fi Station General Scenario</a>&gt;, &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-soft-ap-general-scenario">ESP32 Wi-Fi soft-AP General Scenario</a>&gt;.</p>
</div>
<div class="section" id="event-handling">
<h3>Event-Handling<a class="headerlink" href="wifi.html#event-handling" title="Permalink to this headline">¶</a></h3>
<p>Generally, it is easy to write code in &#8220;sunny-day&#8221; scenarios, such as &lt;<a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a>&gt;, &lt;<a class="reference internal" href="wifi.html#system-event-sta-connected">SYSTEM_EVENT_STA_CONNECTED</a>&gt; etc. The hard part is to write routines in &#8220;rainy-day&#8221; scenarios, such as &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; etc. Good handling of &#8220;rainy-day&#8221; scenarios is fundamental to robust Wi-Fi applications. Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-event-description">ESP32 Wi-Fi Event Description</a>&gt;, &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-station-general-scenario">ESP32 Wi-Fi Station General Scenario</a>&gt;, &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-soft-ap-general-scenario">ESP32 Wi-Fi soft-AP General Scenario</a>&gt;</p>
</div>
<div class="section" id="write-error-recovery-routines-correctly-at-all-times">
<h3>Write Error-Recovery Routines Correctly at All Times<a class="headerlink" href="wifi.html#write-error-recovery-routines-correctly-at-all-times" title="Permalink to this headline">¶</a></h3>
<p>Just like the handling of &#8220;rainy-day&#8221; scenarios, a good error-recovery routine is also fundamental to robust Wi-Fi applications. Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-api-error-code">ESP32 Wi-Fi API Error Code</a>&gt;</p>
</div>
</div>
<div class="section" id="esp32-wi-fi-api-error-code">
<h2>ESP32 Wi-Fi API Error Code<a class="headerlink" href="wifi.html#esp32-wi-fi-api-error-code" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>All of the ESP32 Wi-Fi APIs have well-defined return values, namely, the error code. The error code can be categorized into:</dt>
<dd><ul class="first last simple">
<li>No errors, e.g. ESP_ERR_WIFI_OK means that the API returns successfully</li>
<li>Recoverable errors, such as ESP_ERR_WIFI_NO_MEM, etc.</li>
<li>Non-recoverable, non-critical errors</li>
<li>Non-recoverable, critical errors</li>
</ul>
</dd>
</dl>
<p>Whether the error is critical or not depends on the API and the application scenario, and it is defined by the API user.</p>
<p><strong>The primary principle to write a robust application with Wi-Fi API is to always check the error code and write the error-handling code.</strong> Generally, the error-handling code can be used:</p>
<blockquote>
<div><ul class="simple">
<li>for recoverable errors, in which case you can write a recoverable-error code. For example, when esp_wifi_start returns ESP_ERR_WIFI_NO_MEM, the recoverable-error code vTaskDelay can be called, in order to get a microseconds&#8217; delay for another try.</li>
<li>for non-recoverable, yet non-critical, errors, in which case printing the error code is a good method for error handling.</li>
<li>for non-recoverable, critical errors, in which case &#8220;assert&#8221; may be a good method for error handling. For example, if esp_wifi_set_mode returns ESP_ERR_WIFI_NOT_INIT, it means that the Wi-Fi driver is not initialized by esp_wifi_init successfully. You can detect this kind of error very quickly in the application development phase.</li>
</ul>
</div></blockquote>
<p>In esp_err.h, ESP_ERROR_CHECK checks the return values. It is a rather commonplace error-handling code and can be used
as the default error-handling code in the application development phase. However, we strongly recommend that the API user writes their own error-handling code.</p>
</div>
<div class="section" id="esp32-wi-fi-programming-model">
<h2>ESP32 Wi-Fi Programming Model<a class="headerlink" href="wifi.html#esp32-wi-fi-programming-model" title="Permalink to this headline">¶</a></h2>
<p>The ESP32 Wi-Fi programming model is depicted as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                          <span class="n">default</span> <span class="n">handler</span>              <span class="n">user</span> <span class="n">handler</span>
 <span class="o">-----------</span>               <span class="o">-------------</span>               <span class="o">-------------</span>
<span class="o">|</span>           <span class="o">|</span>   <span class="n">event</span>     <span class="o">|</span>             <span class="o">|</span> <span class="n">callback</span> <span class="ow">or</span> <span class="o">|</span>             <span class="o">|</span>
<span class="o">|</span>   <span class="n">TCPIP</span>   <span class="o">|</span> <span class="o">---------&gt;</span>  <span class="o">|</span>    <span class="n">event</span>    <span class="o">|</span> <span class="o">----------&gt;</span> <span class="o">|</span> <span class="n">application</span> <span class="o">|</span>
<span class="o">|</span>   <span class="n">stack</span>   <span class="o">|</span>             <span class="o">|</span>     <span class="n">task</span>    <span class="o">|</span>  <span class="n">event</span>      <span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span>
 <span class="o">-----------</span>               <span class="o">-------------</span>               <span class="o">-------------</span>
                                <span class="o">/|</span>\                          <span class="o">|</span>
                                 <span class="o">|</span>                           <span class="o">|</span>
                          <span class="n">event</span>  <span class="o">|</span>                           <span class="o">|</span>
                                 <span class="o">|</span>                           <span class="o">|</span>
                                 <span class="o">|</span>                           <span class="o">|</span>
                            <span class="o">-------------</span>                    <span class="o">|</span>
                           <span class="o">|</span>             <span class="o">|</span>                   <span class="o">|</span>
                           <span class="o">|</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span> <span class="n">Driver</span><span class="o">|/</span><span class="n">__________________</span><span class="o">|</span>
                           <span class="o">|</span>             <span class="o">|</span>\     <span class="n">API</span> <span class="n">call</span>
                           <span class="o">|</span>             <span class="o">|</span>
                            <span class="o">-------------</span>
</pre></div>
</div>
<p>The Wi-Fi driver can be considered a black box that knows nothing about high-layer code, such as the
TCPIP stack, application task, event task, etc. All the Wi-Fi driver can do is receive API calls from the high layer,
or post an event-queue to a specified queue which is initialized by API esp_wifi_init().</p>
<p>The event task is a daemon task which receives events from the Wi-Fi driver or from other subsystems, such
as the TCPIP stack. The event task will call the default callback function upon receiving the event. For example,
upon receiving SYSTEM_EVENT_STA_CONNECTED, it will call tcpip_adapter_start() to start the DHCP
client in its default handler.</p>
<p>An application can register its own event callback function by using API esp_event_init. Then, the application callback
function will be called after the default callback. Also, if the application does not want to execute the callback
in the event task, it needs to post the relevant event to the application task in the application callback function.</p>
<p>The application task (code) generally mixes all these things together: it calls APIs to initialize the system/Wi-Fi and
handle the events when necessary.</p>
</div>
<div class="section" id="esp32-wi-fi-event-description">
<h2>ESP32 Wi-Fi Event Description<a class="headerlink" href="wifi.html#esp32-wi-fi-event-description" title="Permalink to this headline">¶</a></h2>
<div class="section" id="system-event-wifi-ready">
<h3>SYSTEM_EVENT_WIFI_READY<a class="headerlink" href="wifi.html#system-event-wifi-ready" title="Permalink to this headline">¶</a></h3>
<p>The Wi-Fi driver will never generate this event, which, as a result, can be ignored by the application event callback. This event may be removed in future releases.</p>
</div>
<div class="section" id="system-event-scan-done">
<h3>SYSTEM_EVENT_SCAN_DONE<a class="headerlink" href="wifi.html#system-event-scan-done" title="Permalink to this headline">¶</a></h3>
<p>The scan-done event is triggered by esp_wifi_scan_start() and will arise in the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li>The scan is completed, e.g., the target AP is found successfully, or all channels have been scanned.</li>
<li>The scan is stopped by esp_wifi_scan_stop().</li>
<li>The esp_wifi_scan_start() is called before the scan is completed. A new scan will override the current scan and a scan-done event will be generated.</li>
</ul>
</div></blockquote>
<p>The scan-done event will not arise in the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li>It is a blocked scan.</li>
<li>The scan is caused by esp_wifi_connect().</li>
</ul>
</div></blockquote>
<p>Upon receiving this event, the event task does nothing. The application event callback needs to call esp_wifi_scan_get_ap_num() and esp_wifi_scan_get_ap_records() to fetch the scanned AP list and trigger the Wi-Fi driver to free the internal memory which is allocated during the scan <strong>(do not forget to do this)</strong>!
Refer to &#8216;ESP32 Wi-Fi Scan&#8217; for a more detailed description.</p>
</div>
<div class="section" id="system-event-sta-start">
<h3>SYSTEM_EVENT_STA_START<a class="headerlink" href="wifi.html#system-event-sta-start" title="Permalink to this headline">¶</a></h3>
<p>If esp_wifi_start() returns ESP_OK and the current Wi-Fi mode is Station or SoftAP+Station, then this event will arise. Upon receiving this event, the event task will initialize the LwIP network interface (netif). Generally, the application event callback needs to call esp_wifi_connect() to connect to the configured AP.</p>
</div>
<div class="section" id="system-event-sta-stop">
<h3>SYSTEM_EVENT_STA_STOP<a class="headerlink" href="wifi.html#system-event-sta-stop" title="Permalink to this headline">¶</a></h3>
<p>If esp_wifi_stop() returns ESP_OK and the current Wi-Fi mode is Station or SoftAP+Station, then this event will arise. Upon receiving this event, the event task will release the station&#8217;s IP address, stop the DHCP client, remove TCP/UDP-related connections and clear the LwIP station netif, etc. The application event callback generally does not need to do anything.</p>
</div>
<div class="section" id="system-event-sta-connected">
<h3>SYSTEM_EVENT_STA_CONNECTED<a class="headerlink" href="wifi.html#system-event-sta-connected" title="Permalink to this headline">¶</a></h3>
<p>If esp_wifi_connect() returns ESP_OK and the station successfully connects to the target AP, the connection event will arise. Upon receiving this event, the event task starts the DHCP client and begins the DHCP process of getting the IP address. Then, the Wi-Fi driver is ready for sending and receiving data. This moment is good for beginning the application work, provided that the application does not depend on LwIP, namely the IP address. However, if the application is LwIP-based, then you need to wait until the <em>got ip</em> event comes in.</p>
</div>
<div class="section" id="system-event-sta-disconnected">
<h3>SYSTEM_EVENT_STA_DISCONNECTED<a class="headerlink" href="wifi.html#system-event-sta-disconnected" title="Permalink to this headline">¶</a></h3>
<p>This event can be generated in the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li>When esp_wifi_disconnect(), or esp_wifi_stop(), or esp_wifi_deinit(), or esp_wifi_restart() is called and the station is already connected to the AP.</li>
<li>When esp_wifi_connect() is called, but the Wi-Fi driver fails to set up a connection with the AP due to certain reasons, e.g. the scan fails to find the target AP, authentication times out, etc.</li>
<li>When the Wi-Fi connection is disrupted because of specific reasons, e.g., the station continuously loses N beacons, the AP kicks off the station, the AP&#8217;s authentication mode is changed, etc.</li>
</ul>
</div></blockquote>
<p>Upon receiving this event, the event task will shut down the station&#8217;s LwIP netif and notify the LwIP task to clear the UDP/TCP connections which cause the wrong status to all sockets. <strong>For socket-based applications, the application callback needs to close all sockets and re-create them, if necessary, upon receiving this event.</strong></p>
<p>Now, let us consider the following scenario:</p>
<blockquote>
<div><ul class="simple">
<li>The application creates a TCP connection to maintain the application-level keep-alive data that is sent out every 60 seconds.</li>
<li>Due to certain reasons, the Wi-Fi connection is cut off, and the &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; is raised. According to the current implementation, <strong>all TCP connections will be removed and the keep-alive socket will be in a wrong status</strong>. However, since the application designer believes that the network layer should NOT care about this error at the Wi-Fi layer, the application does not close the socket.</li>
<li>Five seconds later, the Wi-Fi connection is restored because esp_wifi_connect() is called in the application event callback function.</li>
<li>Sixty seconds later, when the application sends out data with the keep-alive socket, the socket returns an error and the application closes the socket and re-creates it when necessary.</li>
</ul>
</div></blockquote>
<p>Generally, if the application has a correct error-handling code, upon receiving &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; the socket can quickly detect the failure without having to wait for 55 seconds. For applications similar to the keep-alive example, we suggest that you close all sockets, once the &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; is received, and that you restart the application when SYSTEM_EVENT_STA_CONNECTED arises.</p>
<p>Ideally, the application sockets and the network layer should not be affected, since the Wi-Fi connection only fails temporarily and recovers very quickly. In future IDF releases, we are going to provide a more robust solution for handling events that disrupt Wi-Fi connection, as ESP32&#8217;s Wi-Fi functionality continuously improves.</p>
</div>
<div class="section" id="system-event-sta-authmode-change">
<h3>SYSTEM_EVENT_STA_AUTHMODE_CHANGE<a class="headerlink" href="wifi.html#system-event-sta-authmode-change" title="Permalink to this headline">¶</a></h3>
<p>This event arises when the AP to which the station is connected changes its authentication mode, e.g., from no auth to WPA. Upon receiving this event, the event task will do nothing. Generally, the application event callback does not need to handle this either.</p>
</div>
<div class="section" id="system-event-sta-got-ip">
<h3>SYSTEM_EVENT_STA_GOT_IP<a class="headerlink" href="wifi.html#system-event-sta-got-ip" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="system-event-ap-sta-got-ip6">
<h3>SYSTEM_EVENT_AP_STA_GOT_IP6<a class="headerlink" href="wifi.html#system-event-ap-sta-got-ip6" title="Permalink to this headline">¶</a></h3>
<p>This event arises when the DHCP client successfully gets the IP address from the DHCP server. The event means that everything is ready and the application can begin its tasks (e.g., creating sockets).</p>
<p>The IP may be changed because of the following reasons:</p>
<blockquote>
<div><ul class="simple">
<li>The DHCP client fails to renew/rebind the IP address, and the station&#8217;s IP is reset to 0.</li>
<li>The DHCP client rebinds to a different address.</li>
<li>The static-configured IP address is changed.</li>
</ul>
</div></blockquote>
<p>The socket is based on the IP address, which means that, if the IP changes, all sockets relating to this IP will become abnormal. Upon receiving this event, the application needs to close all sockets and recreate the application when the IP changes to a valid one.</p>
</div>
<div class="section" id="system-event-ap-start">
<h3>SYSTEM_EVENT_AP_START<a class="headerlink" href="wifi.html#system-event-ap-start" title="Permalink to this headline">¶</a></h3>
<p>Similar to &lt;<a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a>&gt;.</p>
</div>
<div class="section" id="system-event-ap-stop">
<h3>SYSTEM_EVENT_AP_STOP<a class="headerlink" href="wifi.html#system-event-ap-stop" title="Permalink to this headline">¶</a></h3>
<p>Similar to &lt;<a class="reference internal" href="wifi.html#system-event-sta-stop">SYSTEM_EVENT_STA_STOP</a>&gt;.</p>
</div>
<div class="section" id="system-event-ap-staconnected">
<h3>SYSTEM_EVENT_AP_STACONNECTED<a class="headerlink" href="wifi.html#system-event-ap-staconnected" title="Permalink to this headline">¶</a></h3>
<p>Every time a station is connected to ESP32 SoftAP, the &lt;<a class="reference internal" href="wifi.html#system-event-ap-staconnected">SYSTEM_EVENT_AP_STACONNECTED</a>&gt; will arise. Upon receiving this event, the event task will do nothing, and the application callback can also ignore it. However, you may want to do something, for example, to get the info of the connected STA, etc.</p>
</div>
<div class="section" id="system-event-ap-stadisconnected">
<h3>SYSTEM_EVENT_AP_STADISCONNECTED<a class="headerlink" href="wifi.html#system-event-ap-stadisconnected" title="Permalink to this headline">¶</a></h3>
<p>This event can happen in the following scenarios:</p>
<blockquote>
<div><ul class="simple">
<li>The application calls esp_wifi_disconnect(), or esp_wifi_deauth_sta(), to manually disconnect the station.</li>
<li>The Wi-Fi driver kicks off the station, e.g. because the SoftAP has not received any packets in the past five minutes, etc.</li>
<li>The station kicks off the SoftAP.</li>
</ul>
</div></blockquote>
<p>When this event happens, the event task will do nothing, but the application event callback needs to do something, e.g., close the socket which is related to this station, etc.</p>
</div>
<div class="section" id="system-event-ap-probereqrecved">
<h3>SYSTEM_EVENT_AP_PROBEREQRECVED<a class="headerlink" href="wifi.html#system-event-ap-probereqrecved" title="Permalink to this headline">¶</a></h3>
<p>Currently, the ESP32 implementation will never generate this event. It may be removed in future releases.</p>
</div>
</div>
<div class="section" id="esp32-wi-fi-station-general-scenario">
<h2>ESP32 Wi-Fi Station General Scenario<a class="headerlink" href="wifi.html#esp32-wi-fi-station-general-scenario" title="Permalink to this headline">¶</a></h2>
<p>Below is a &#8220;big scenario&#8221; which describes some small scenarios in Station mode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>          <span class="o">---------</span>
<span class="o">|</span>  <span class="n">Main</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">app</span>   <span class="o">|</span>         <span class="o">|</span>  <span class="n">Event</span>  <span class="o">|</span>         <span class="o">|</span>  <span class="n">LwIP</span>   <span class="o">|</span>        <span class="o">|</span>  <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>        <span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>          <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>              <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">LwIP</span>    <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|----------------------------------------------------------&gt;|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>     <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">event</span>            <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>                   <span class="o">|</span>                  <span class="o">|</span>      <span class="mf">1.</span> <span class="n">Init</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="mf">1.3</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>             <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>          <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.4</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">app</span> <span class="n">task</span>                 <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|------------------&gt;|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="mi">2</span><span class="o">&gt;</span> <span class="n">configure</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>                 <span class="o">|</span>                  <span class="o">|</span>      <span class="mf">2.</span> <span class="n">Configure</span> <span class="n">Phase</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>         <span class="mf">3.1</span><span class="o">&gt;</span> <span class="n">start</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>              <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>     <span class="mf">3.2</span> <span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_START</span>     <span class="o">|</span>     <span class="mf">3.</span> <span class="n">Start</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>
     <span class="o">|</span>              <span class="mf">3.3</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_START</span>                  <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>               <span class="mf">4.1</span><span class="o">&gt;</span> <span class="n">connect</span> <span class="n">wifi</span>       <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>     <span class="mf">4.</span> <span class="n">Connect</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>   <span class="mf">4.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_CONNECTED</span>    <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>          <span class="o">|</span>
     <span class="o">|</span>              <span class="mf">4.3</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_CONNECTED</span>              <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>               <span class="mf">5.1</span><span class="o">&gt;</span> <span class="n">start</span> <span class="n">DHCP</span> <span class="n">client</span>  <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|------------------&gt;|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>               <span class="mf">5.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_GOT_IP</span>               <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                  <span class="o">|</span>
     <span class="o">|</span>                 <span class="mf">5.3</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_GOT_IP</span>              <span class="o">|</span>                  <span class="o">|</span>     <span class="mf">5.</span> <span class="n">Got</span> <span class="n">IP</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|-----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>     <span class="o">|</span> <span class="mf">5.4</span><span class="o">&gt;</span> <span class="n">socket</span> <span class="n">related</span> <span class="n">init</span>        <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>   <span class="mf">6.1</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span> <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>
     <span class="o">|</span>              <span class="mf">6.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>           <span class="o">|</span>                  <span class="o">|</span>     <span class="mf">6.</span> <span class="n">Disconnect</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|-----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>     <span class="o">|</span> <span class="mf">6.3</span><span class="o">&gt;</span> <span class="n">disconnect</span> <span class="n">handling</span>        <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>               <span class="mf">7.1</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_GOT_IP</span>               <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                 <span class="mf">7.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_GOT_IP</span>              <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>    <span class="mf">7.</span> <span class="n">IP</span> <span class="n">change</span> <span class="n">phase</span>
     <span class="o">|</span>                   <span class="o">|-----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>     <span class="o">|</span> <span class="mf">7.3</span><span class="o">&gt;</span> <span class="n">socket</span> <span class="n">error</span> <span class="n">handling</span>      <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">8.1</span><span class="o">&gt;</span> <span class="n">disconnect</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>       <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">8.2</span><span class="o">&gt;</span> <span class="n">stop</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>             <span class="o">|</span>                  <span class="o">|</span>    <span class="mf">8.</span> <span class="n">Deinit</span> <span class="n">phase</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">8.3</span><span class="o">&gt;</span> <span class="n">deinit</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>           <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
</pre></div>
</div>
<div class="section" id="wi-fi-lwip-init-phase">
<h3>1. Wi-Fi/LwIP Init Phase<a class="headerlink" href="wifi.html#wi-fi-lwip-init-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s1.1: The main task calls tcpip_adapter_init() to create an LwIP core task and initialize LwIP-related work.</li>
<li>s1.2: The main task calls esp_event_loop_init() to create a system Event task and initialize an application event&#8217;s callback function. In the scenario above, the application event&#8217;s callback function does nothing but relaying the event to the application task.</li>
<li>s1.3: The main task calls esp_wifi_init() to create the Wi-Fi driver task and initialize the Wi-Fi driver.</li>
<li>s1.4: The main task calls OS API to create the application task.</li>
</ul>
</div></blockquote>
<p>Step 1.1~1.4 is a recommended sequence that initializes a Wi-Fi-/LwIP-based application. However, it is <strong>NOT</strong> a must-follow sequence, which means that you can create the application task in step 1.1 and put all other initializations in the application task. Moreover, you may not want to create the application task in the initialization phase if the application task depends on the sockets. Rather, you can defer the task creation until the IP is obtained.</p>
</div>
<div class="section" id="wi-fi-configuration-phase">
<h3>2. Wi-Fi Configuration Phase<a class="headerlink" href="wifi.html#wi-fi-configuration-phase" title="Permalink to this headline">¶</a></h3>
<p>Once the Wi-Fi driver is initialized, you can start configuring the Wi-Fi driver. In this scenario, the mode is Station, so you may need to call esp_wifi_set_mode(WIFI_MODE_STA) to configure the Wi-Fi mode as Station. You can call other esp_wifi_set_xxx APIs to configure more settings, such as the protocol mode, country code, bandwidth, etc. Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-configuration">ESP32 Wi-Fi Configuration</a>&gt;.</p>
<p>Generally, we configure the Wi-Fi driver before setting up the Wi-Fi connection, but this is <strong>NOT</strong> mandatory, which means that you can configure the Wi-Fi connection anytime, provided that the Wi-Fi driver is initialized successfully. However, if the configuration does not need to change after the Wi-Fi connection is set up, you should configure the Wi-Fi driver at this stage, because the configuration APIs (such as esp_wifi_set_protocol) will cause the Wi-Fi to reconnect, which may not be desirable.</p>
<p>If the Wi-Fi NVS flash is enabled by menuconfig, all Wi-Fi configuration in this phase, or later phases, will be stored into flash. When the board powers on/reboots, you do not need to configure the Wi-Fi driver from scratch. You only need to call esp_wifi_get_xxx APIs to fetch the configuration stored in flash previously. You can also configure the Wi-Fi driver if the previous configuration is not what you want.</p>
</div>
<div class="section" id="wi-fi-start-phase">
<h3>3. Wi-Fi Start Phase<a class="headerlink" href="wifi.html#wi-fi-start-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s3.1: Call esp_wifi_start to start the Wi-Fi driver.</li>
<li>s3.2: The Wi-Fi driver posts &lt;<a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a>&gt; to the event task; then, the event task will do some common things and will call the application event callback function.</li>
<li>s3.3: The application event callback function relays the &lt;<a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a>&gt; to the application task. We recommend that you call esp_wifi_connect(). However, you can also call esp_wifi_connect() in other phrases after the &lt;<a class="reference internal" href="wifi.html#system-event-sta-start">SYSTEM_EVENT_STA_START</a>&gt; arises.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-connect-phase">
<h3>4. Wi-Fi Connect Phase<a class="headerlink" href="wifi.html#wi-fi-connect-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s4.1: Once esp_wifi_connect() is called, the Wi-Fi driver will start the internal scan/connection process.</li>
<li>s4.2: If the internal scan/connection process is successful, the &lt;<a class="reference internal" href="wifi.html#system-event-sta-connected">SYSTEM_EVENT_STA_CONNECTED</a>&gt; will be generated. In the event task, it starts the DHCP client, which will finally trigger the DHCP process.</li>
<li>s4.3: In the above-mentioned scenario, the application event callback will relay the event to the application task. Generally, the application needs to do nothing, and you can do whatever you want, e.g., print a log, etc.</li>
</ul>
</div></blockquote>
<p>In step 4.2, the Wi-Fi connection may fail because, for example, the password is wrong, the AP is not found, etc. In a case like this, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise and the reason for such a failure will be provided. For handling events that disrupt Wi-Fi connection, please refer to phase 6.</p>
</div>
<div class="section" id="wi-fi-got-ip-phase">
<h3>5. Wi-Fi &#8216;Got IP&#8217; Phase<a class="headerlink" href="wifi.html#wi-fi-got-ip-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s5.1: Once the DHCP client is initialized in step 4.2, the <em>got IP</em> phase will begin.</li>
<li>s5.2: If the IP address is successfully received from the DHCP server, then &lt;<a class="reference internal" href="wifi.html#system-event-sta-got-ip">SYSTEM_EVENT_STA_GOT_IP</a>&gt; will arise and the event task will perform common handling.</li>
<li>s5.3: In the application event callback, &lt;<a class="reference internal" href="wifi.html#system-event-sta-got-ip">SYSTEM_EVENT_STA_GOT_IP</a>&gt; is relayed to the application task. For LwIP-based applications, this event is very special and means that everything is ready for the application to begin its tasks, e.g. creating the TCP/UDP socket, etc. A very common mistake is to initialize the socket before &lt;<a class="reference internal" href="wifi.html#system-event-sta-got-ip">SYSTEM_EVENT_STA_GOT_IP</a>&gt; is received. <strong>DO NOT start the socket-related work before the IP is received.</strong></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-disconnect-phase">
<h3>6. Wi-Fi Disconnect Phase<a class="headerlink" href="wifi.html#wi-fi-disconnect-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s6.1: When the Wi-Fi connection is disrupted, e.g. because the AP is powered off, the RSSI is poor, etc., &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise. This event may also arise in phase 3. Here, the event task will notify the LwIP task to clear/remove all UDP/TCP connections. Then, all application sockets will be in a wrong status. In other words, no socket can work properly when this event happens.</li>
<li>s6.2: In the scenario described above, the application event callback function relays &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; to the application task. We recommend that esp_wifi_connect() be called to reconnect the Wi-Fi, close all sockets and re-create them if necessary. Refer to &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt;.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-ip-change-phase">
<h3>7. Wi-Fi IP Change Phase<a class="headerlink" href="wifi.html#wi-fi-ip-change-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s7.1: If the IP address is changed, the &lt;<a class="reference internal" href="wifi.html#system-event-sta-got-ip">SYSTEM_EVENT_STA_GOT_IP</a>&gt; will arise.</li>
<li>s7.2: <strong>This event is important to the application. When it occurs, the timing is good for closing all created sockets and recreating them.</strong></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-deinit-phase">
<h3>8. Wi-Fi Deinit Phase<a class="headerlink" href="wifi.html#wi-fi-deinit-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s8.1: Call esp_wifi_disconnect() to disconnect the Wi-Fi connectivity.</li>
<li>s8.2: Call esp_wifi_stop() to stop the Wi-Fi driver.</li>
<li>s8.3: Call esp_wifi_deinit() to unload the Wi-Fi driver.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="esp32-wi-fi-soft-ap-general-scenario">
<h2>ESP32 Wi-Fi soft-AP General Scenario<a class="headerlink" href="wifi.html#esp32-wi-fi-soft-ap-general-scenario" title="Permalink to this headline">¶</a></h2>
<p>Below is a &#8220;big scenario&#8221; which describes some small scenarios in Soft-AP mode:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>          <span class="o">---------</span>
<span class="o">|</span>  <span class="n">Main</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">app</span>   <span class="o">|</span>         <span class="o">|</span>  <span class="n">Event</span>  <span class="o">|</span>         <span class="o">|</span>  <span class="n">LwIP</span>   <span class="o">|</span>        <span class="o">|</span>  <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>  <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>        <span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>          <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>              <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">LwIP</span>    <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|----------------------------------------------------------&gt;|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>     <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">event</span>            <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>                   <span class="o">|</span>                  <span class="o">|</span>     <span class="mf">1.</span> <span class="n">Init</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="mf">1.3</span><span class="o">&gt;</span> <span class="n">create</span><span class="o">/</span><span class="n">init</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>             <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>          <span class="o">|</span>
     <span class="o">|</span>  <span class="mf">1.4</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">app</span> <span class="n">task</span>                 <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|------------------&gt;|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="mi">2</span><span class="o">&gt;</span> <span class="n">configure</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>                 <span class="o">|</span>                  <span class="o">|</span>     <span class="mf">2.</span> <span class="n">Configure</span> <span class="n">Phase</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>         <span class="mf">3.1</span><span class="o">&gt;</span> <span class="n">start</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>              <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|-----------------------------------------------------------------------------&gt;|</span>     <span class="mf">3.</span> <span class="n">Start</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>     <span class="mf">3.2</span> <span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_AP_START</span>      <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>          <span class="o">|</span>
     <span class="o">|</span>              <span class="mf">3.3</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_AP_START</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>   <span class="mf">4.1</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_AP_STACONNECTED</span>  <span class="o">|</span>     <span class="mf">4.</span> <span class="n">Connect</span> <span class="n">Phase</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>
     <span class="o">|</span>              <span class="mf">4.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_AP_STACONNECTED</span>            <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>   <span class="mf">5.1</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span> <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;-------------------------------------|</span>     <span class="mf">5.</span> <span class="n">Disconnect</span> <span class="n">Phase</span>
     <span class="o">|</span>              <span class="mf">5.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>           <span class="o">|</span>                  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|-----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>     <span class="o">|</span> <span class="mf">5.3</span><span class="o">&gt;</span> <span class="n">disconnect</span> <span class="n">handling</span>        <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;----</span>              <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">6.1</span><span class="o">&gt;</span> <span class="n">disconnect</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>       <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">6.2</span><span class="o">&gt;</span> <span class="n">stop</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>             <span class="o">|</span>                  <span class="o">|</span>    <span class="mf">6.</span> <span class="n">Deinit</span> <span class="n">phase</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>           <span class="mf">6.3</span><span class="o">&gt;</span> <span class="n">deinit</span> <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>           <span class="o">|</span>                  <span class="o">|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|---------------------------------------------------------&gt;|</span>          <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>         <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>                  <span class="o">|</span>
</pre></div>
</div>
</div>
<div class="section" id="esp32-wi-fi-scan">
<h2>ESP32 Wi-Fi Scan<a class="headerlink" href="wifi.html#esp32-wi-fi-scan" title="Permalink to this headline">¶</a></h2>
<p>Currently, the esp_wifi_scan_start() API is supported only in Station or Station+SoftAP mode.</p>
<div class="section" id="scan-type">
<h3>Scan Type<a class="headerlink" href="wifi.html#scan-type" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Active Scan</td>
<td>Scan by sending a probe request.
The default scan is an active scan.</td>
</tr>
<tr class="row-odd"><td>Passive Scan</td>
<td>No probe request is sent out. Just switch to the specific
channel and wait for a beacon.
Application can enable it via the scan_type field of
wifi_scan_config_t.</td>
</tr>
<tr class="row-even"><td>Foreground Scan</td>
<td>This scan is applicable when there is no Wi-Fi connection
in Station mode. Foreground or background scanning is
controlled by the Wi-Fi driver and cannot be configured by
the application.</td>
</tr>
<tr class="row-odd"><td>Background Scan</td>
<td>This scan is applicable when there is a Wi-Fi connection in
Station mode or in Station+SoftAP mode.
Whether it is a foreground scan or background scan depends on
the Wi-Fi driver and cannot be configured by the application.</td>
</tr>
<tr class="row-even"><td>All-Channel Scan</td>
<td>It scans all of the channels.
If the channel field of wifi_scan_config_t is set to 0, it is
an all-channel scan.</td>
</tr>
<tr class="row-odd"><td><dl class="first last docutils">
<dt>Specific Channel</dt>
<dd>Scan</dd>
</dl>
</td>
<td>It scans specific channels only.
If the channel field of wifi_scan_config_t set to 1, it is a
specific-channel scan.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>The scan modes in above table can be combined arbitrarily, so we totally have 8 different scans:</dt>
<dd><ul class="first last simple">
<li>All-Channel Background Active Scan</li>
<li>All-Channel Background Passive Scan</li>
<li>All-Channel Foreground Active Scan</li>
<li>All-Channel Foreground Passive Scan</li>
<li>Specific-Channel Background Active Scan</li>
<li>Specific-Channel Background Passive Scan</li>
<li>Specific-Channel Foreground Active Scan</li>
<li>Specific-Channel Foreground Passive Scan</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="scan-configuration">
<h3>Scan Configuration<a class="headerlink" href="wifi.html#scan-configuration" title="Permalink to this headline">¶</a></h3>
<p>The scan type and other scan attributes are configured by esp_wifi_scan_start. The table below provides a detailed description of wifi_scan_config_t.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ssid</td>
<td>If the SSID is not NULL, it is only the AP with the same
SSID that can be scanned.</td>
</tr>
<tr class="row-odd"><td>bssid</td>
<td>If the BSSID is not NULL, it is only the AP with the same
BSSID that can be scanned.</td>
</tr>
<tr class="row-even"><td>channel</td>
<td>If &#8220;channel&#8221; is 0, there will be an all-channel scan;
otherwise, there will be a specific-channel scan.</td>
</tr>
<tr class="row-odd"><td>show_hidden</td>
<td>If &#8220;show_hidden&#8221; is 0, the scan ignores the AP with a hidden
SSID; otherwise, the scan considers the hidden AP a normal
one.</td>
</tr>
<tr class="row-even"><td>scan_type</td>
<td>If &#8220;scan_type&#8221; is WIFI_SCAN_TYPE_ACTIVE, the scan is
&#8220;active&#8221;; otherwise, it is a &#8220;passive&#8221; one.</td>
</tr>
<tr class="row-odd"><td>scan_time</td>
<td><p class="first">This field is used to control how long the scan dwells on
each channel.</p>
<p>For passive scans, scan_time.passive designates the dwell
time for each channel.</p>
<p>For active scans, dwell times for each channel are listed
in the table below. Here, min is short for scan
time.active.min and max is short for scan_time.active.max.</p>
<ul class="simple">
<li>min=0, max=0: scan dwells on each channel for 120 ms.</li>
<li>min&gt;0, max=0: scan dwells on each channel for 120 ms.</li>
<li>min=0, max&gt;0: scan dwells on each channel for <code class="docutils literal"><span class="pre">max</span></code> ms.</li>
<li>min&gt;0, max&gt;0: the minimum time the scan dwells on each
channel is <code class="docutils literal"><span class="pre">min</span></code> ms. If no AP is found during this time
frame, the scan switches to the next channel. Otherwise,
the scan dwells on the channel for <code class="docutils literal"><span class="pre">max</span></code> ms.</li>
</ul>
<p class="last">If you want to improve the performance of the
the scan, you can try to modify these two parameters.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scan-all-aps-in-all-channels-foreground">
<h3>Scan All APs In All Channels(foreground)<a class="headerlink" href="wifi.html#scan-all-aps-in-all-channels-foreground" title="Permalink to this headline">¶</a></h3>
<p>Scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
<span class="o">|</span>  <span class="n">app</span>    <span class="o">|</span>         <span class="o">|</span>  <span class="n">event</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span> <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>      <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">Configure</span> <span class="n">country</span> <span class="n">code</span>      <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>      <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">configuration</span>          <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.1</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="mi">1</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.2</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="mi">2</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>      <span class="o">....</span>  <span class="o">...</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.</span><span class="n">x</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="n">N</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>           <span class="mf">3.1</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>
     <span class="o">|</span>  <span class="mf">3.2</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>           <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p>The scenario above describes an all-channel, foreground scan. The foreground scan can only occur in Station mode where the station does not connect to any AP. Whether it is a foreground or background scan is totally determined by the Wi-Fi driver, and cannot be configured by the application.</p>
<p>Detailed scenario description:</p>
<div class="section" id="scan-configuration-phase">
<h4>Scan Configuration Phase<a class="headerlink" href="wifi.html#scan-configuration-phase" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>s1.1: Call esp_wifi_set_country() to set the country code. For China/Japan, the channel value ranges from 1 to 14; for the USA, it ranges from 1 to 11; and for Europe, it ranges from 1 to 13. The default country is China.</li>
<li>s1.2: Call esp_wifi_scan_start() to configure the scan. To do so, you can refer to &lt;<a class="reference internal" href="wifi.html#scan-configuration">Scan Configuration</a>&gt;. Since this is an all-channel scan, just set the SSID/BSSID/channel to 0.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-driver-s-internal-scan-phase">
<h4>Wi-Fi Driver&#8217;s Internal Scan Phase<a class="headerlink" href="wifi.html#wi-fi-driver-s-internal-scan-phase" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>s2.1: The Wi-Fi driver switches to channel 1, in case the scan type is WIFI_SCAN_TYPE_ACTIVE, and broadcasts a probe request. Otherwise, the Wi-Fi will wait for a beacon from the APs. The Wi-Fi driver will stay in channel 1 for some time. The dwell time is configured in min/max time, with default value being 120 ms.</li>
<li>s2.2: The Wi-Fi driver switches to channel 2 and performs the same operation as in step 2.1.</li>
<li>s2.3: The Wi-Fi driver scans the last channel N, where N is determined by the country code which is configured in step 1.1.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="scan-done-event-handling-phase">
<h4>Scan-Done Event Handling Phase<a class="headerlink" href="wifi.html#scan-done-event-handling-phase" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>s3.1: When all channels are scanned, &lt;<a class="reference internal" href="wifi.html#system-event-scan-done">SYSTEM_EVENT_SCAN_DONE</a>&gt; will arise.</li>
<li>s3.2: The application&#8217;s event callback function notifies the application task that &lt;<a class="reference internal" href="wifi.html#system-event-scan-done">SYSTEM_EVENT_SCAN_DONE</a>&gt; is received. esp_wifi_scan_get_ap_num() is called to get the number of APs that have been found in this scan. Then, it allocates enough entries and calls esp_wifi_scan_get_ap_records() to get the AP records. Please note that the AP records in the Wi-Fi driver will be freed, once esp_wifi_scan_get_ap_records() is called. Do not call esp_wifi_scan_get_ap_records() twice for a single scan-done event. If esp_wifi_scan_get_ap_records() is not called when the scan-done event occurs, the AP records allocated by the Wi-Fi driver will not be freed. So, make sure you call esp_wifi_scan_get_ap_records(), yet only once.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="scan-all-aps-on-all-channels-background">
<h3>Scan All APs on All Channels(background)<a class="headerlink" href="wifi.html#scan-all-aps-on-all-channels-background" title="Permalink to this headline">¶</a></h3>
<p>Scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
<span class="o">|</span>  <span class="n">app</span>    <span class="o">|</span>         <span class="o">|</span>  <span class="n">event</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span> <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>      <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">Configure</span> <span class="n">country</span> <span class="n">code</span>      <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>      <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">configuration</span>          <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.1</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="mi">1</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.2</span><span class="o">&gt;</span> <span class="n">Back</span> <span class="n">to</span> <span class="n">home</span> <span class="n">channel</span> <span class="n">H</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.3</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="mi">2</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.4</span><span class="o">&gt;</span> <span class="n">Back</span> <span class="n">to</span> <span class="n">home</span> <span class="n">channel</span> <span class="n">H</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>      <span class="o">....</span>  <span class="o">...</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="n">N</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.</span><span class="n">x</span><span class="o">&gt;</span> <span class="n">Back</span> <span class="n">to</span> <span class="n">home</span> <span class="n">channel</span> <span class="n">H</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>           <span class="mf">3.1</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>
     <span class="o">|</span>  <span class="mf">3.2</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>           <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p>The scenario above is an all-channel background scan. Compared to <a class="reference internal" href="wifi.html#scan-all-aps-in-all-channels-foreground">Scan All APs In All Channels(foreground)</a> , the difference in the all-channel background scan is that the Wi-Fi driver will scan the back-to-home channel for 30 ms before it switches to the next channel to give the Wi-Fi connection a chance to transmit/receive data.</p>
</div>
<div class="section" id="scan-for-a-specific-ap-in-all-channels">
<h3>Scan for a Specific AP in All Channels<a class="headerlink" href="wifi.html#scan-for-a-specific-ap-in-all-channels" title="Permalink to this headline">¶</a></h3>
<p>Scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
<span class="o">|</span>  <span class="n">app</span>    <span class="o">|</span>         <span class="o">|</span>  <span class="n">event</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span> <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>      <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">Configure</span> <span class="n">country</span> <span class="n">code</span>      <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>      <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">configuration</span>          <span class="o">|</span>
     <span class="o">|--------------------------------------&gt;|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.1</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="n">C1</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.2</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="n">C2</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span> <span class="o">...</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|----</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">2.</span><span class="n">x</span><span class="o">&gt;</span> <span class="n">Scan</span> <span class="n">channel</span> <span class="n">CN</span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">AP</span> <span class="ow">is</span> <span class="n">found</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|&lt;---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>           <span class="mf">3.1</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>  <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>
     <span class="o">|</span>  <span class="mf">3.2</span> <span class="n">SYSTEM_EVENT_SCAN_DONE</span>           <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<p>This scan is similar to <a class="reference internal" href="wifi.html#scan-all-aps-in-all-channels-foreground">Scan All APs In All Channels(foreground)</a>. The differences are:</p>
<blockquote>
<div><ul class="simple">
<li>s1.1: In step 1.2, the target AP will be configured to SSID/BSSID.</li>
<li>s2.1~s2.N: Each time the Wi-Fi driver scans an AP, it will check whether it is a target AP or not. If it is a target AP, then the scan-done event will arise and scanning will end; otherwise, the scan will continue. Please note that the first scanned channel may not be channel 1, because the Wi-Fi driver optimizes the scanning sequence.</li>
</ul>
</div></blockquote>
<p>If there are more than one APs which match the target AP info, for example, if we happen to scan two APs whose SSID is &#8220;ap&#8221;, then only the first AP will be returned. However, if the first AP is not the one you want, e.g., if its password is wrong, then the Wi-Fi driver will detect a four-way handshake failure and try to scan the next AP. If two APs have the same SSID, BSSID and password, then the Wi-Fi driver will choose the first one to connect to.</p>
<p>You can scan a specific AP, or all of them, in any given channel. These two scenarios are very similar.</p>
</div>
<div class="section" id="scan-in-wi-fi-connect">
<h3>Scan in Wi-Fi Connect<a class="headerlink" href="wifi.html#scan-in-wi-fi-connect" title="Permalink to this headline">¶</a></h3>
<p>When esp_wifi_connect() is called, then the Wi-Fi driver will try to scan the configured AP first. The scan in &#8220;Wi-Fi Connect&#8221; is the same as <a class="reference internal" href="wifi.html#scan-for-a-specific-ap-in-all-channels">Scan for a Specific AP In All Channels</a>, except that no scan-done event will be generated when the scan is completed. If the target AP is found, then the Wi-Fi driver will start the Wi-Fi connection; otherwise, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will be generated. Refer to <a class="reference internal" href="wifi.html#scan-for-a-specific-ap-in-all-channels">Scan for a Specific AP in All Channels</a></p>
</div>
<div class="section" id="scan-in-blocked-mode">
<h3>Scan In Blocked Mode<a class="headerlink" href="wifi.html#scan-in-blocked-mode" title="Permalink to this headline">¶</a></h3>
<p>If the block parameter of esp_wifi_scan_start() is true, then the scan is a blocked one, and the application task will be blocked until the scan is done. The blocked scan is similar to an unblocked one, except that no scan-done event will arise when the blocked scan is completed.</p>
</div>
<div class="section" id="parallel-scan">
<h3>Parallel Scan<a class="headerlink" href="wifi.html#parallel-scan" title="Permalink to this headline">¶</a></h3>
<p>Two application tasks may call esp_wifi_scan() at the same time, or the same application task calls esp_wifi_scan_start() before it gets a scan-done event. Both scenarios can happen. <strong>However, in IDF2.1, the Wi-Fi driver does not support parallel scans adequately. As a result, a parallel scan should be avoided.</strong> The parallel scan will be enhanced in future releases, as the ESP32&#8217;s Wi-Fi functionality improves continuously.</p>
</div>
</div>
<div class="section" id="esp32-wi-fi-station-connecting-scenario">
<h2>ESP32 Wi-Fi Station Connecting Scenario<a class="headerlink" href="wifi.html#esp32-wi-fi-station-connecting-scenario" title="Permalink to this headline">¶</a></h2>
<p>Generally, the application does not need to care about the connecting process. Below is a brief introduction to the process for those who are really interested.</p>
<p>Scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
<span class="o">|</span>  <span class="n">Event</span>  <span class="o">|</span>         <span class="o">|</span>   <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span> <span class="o">|</span>         <span class="o">|</span>  <span class="n">AP</span>     <span class="o">|</span>
<span class="o">|</span>  <span class="n">task</span>   <span class="o">|</span>         <span class="o">|</span>   <span class="n">task</span>  <span class="o">|</span>         <span class="o">|</span>         <span class="o">|</span>
 <span class="o">---------</span>           <span class="o">---------</span>           <span class="o">---------</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>       <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|----</span>               <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>    <span class="o">|</span> <span class="mf">1.1</span><span class="o">&gt;</span> <span class="n">Scan</span>    <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;---</span>               <span class="o">|</span>      <span class="n">Scan</span> <span class="n">phase</span>
     <span class="o">|</span> <span class="mf">1.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>       <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                    <span class="mf">2.1</span><span class="o">&gt;</span> <span class="n">Auth</span> <span class="n">Request</span>  <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|------------------&gt;|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">2.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>      <span class="n">Auth</span> <span class="n">phase</span>
     <span class="o">|</span>                    <span class="mf">2.3</span><span class="o">&gt;</span> <span class="n">Auth</span> <span class="n">Response</span> <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">2.4</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>       <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">3.1</span> <span class="n">Assoc</span> <span class="n">Request</span> <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|------------------&gt;|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">3.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>     <span class="n">Assoc</span> <span class="n">phase</span>
     <span class="o">|</span>                    <span class="mf">3.3</span> <span class="n">Assoc</span> <span class="n">Response</span> <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">3.4</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>       <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">4.1</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="n">EAPOL</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.2</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">4.3</span><span class="o">&gt;</span> <span class="mi">2</span><span class="o">/</span><span class="mi">4</span> <span class="n">EAPOL</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|------------------&gt;|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.4</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>     <span class="mi">4</span><span class="o">-</span><span class="n">way</span> <span class="n">handshake</span> <span class="n">phase</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">4.5</span><span class="o">&gt;</span> <span class="mi">3</span><span class="o">/</span><span class="mi">4</span> <span class="n">EAPOL</span>    <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|&lt;------------------|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.6</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span> <span class="mf">4.7</span><span class="o">&gt;</span> <span class="mi">4</span><span class="o">/</span><span class="mi">4</span> <span class="n">EAPOL</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|------------------&gt;|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.8</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|</span> <span class="mf">4.9</span><span class="o">&gt;</span> <span class="n">SYSTEM_EVENT_STA_DISCONNECTED</span>    <span class="o">|</span>        <span class="o">|</span>
     <span class="o">|&lt;------------------|</span>                   <span class="o">|</span>       <span class="o">---</span>
     <span class="o">|</span>                   <span class="o">|</span>                   <span class="o">|</span>
</pre></div>
</div>
<div class="section" id="scan-phase">
<h3>Scan Phase<a class="headerlink" href="wifi.html#scan-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s1.1, The Wi-Fi driver begins scanning in &#8220;Wi-Fi Connect&#8221;. Refer to &lt;<a class="reference internal" href="wifi.html#scan-in-wi-fi-connect">Scan in Wi-Fi Connect</a>&gt; for more details.</li>
<li>s1.2, If the scan fails to find the target AP, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise and the reason-code will be WIFI_REASON_NO_AP_FOUND. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="auth-phase">
<h3>Auth Phase<a class="headerlink" href="wifi.html#auth-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s2.1, The authentication request packet is sent and the auth timer is enabled.</li>
<li>s2.2, If the authentication response packet is not received before the authentication timer times out, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise and the reason-code will be WIFI_REASON_AUTH_EXPIRE. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
<li>s2.3, The auth-response packet is received and the auth-timer is stopped.</li>
<li>s2.4, The AP rejects authentication in the response and &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; arises, while the reason-code is WIFI_REASON_AUTH_FAIL or the reasons specified by the soft-AP. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="association-phase">
<h3>Association Phase<a class="headerlink" href="wifi.html#association-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s3.1, The association request is sent and the association timer is enabled.</li>
<li>s3.2, If the association response is not received before the association timer times out, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise and the reason-code will be WIFI_REASON_ASSOC_EXPIRE. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
<li>s3.3, The association response is received and the association timer is stopped.</li>
<li>s3.4, The AP rejects the association in the response and &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; arises, while the reason-code is the one specified in the association response. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="four-way-handshake-phase">
<h3>Four-way Handshake Phase<a class="headerlink" href="wifi.html#four-way-handshake-phase" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>s4.1, The four-way handshake is sent out and the association timer is enabled.</li>
<li>s4.2, If the association response is not received before the association timer times out, &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; will arise and the reason-code will be WIFI_REASON_ASSOC_EXPIRE. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
<li>s4.3, The association response is received and the association timer is stopped.</li>
<li>s4.4, The AP rejects the association in the response and &lt;<a class="reference internal" href="wifi.html#system-event-sta-disconnected">SYSTEM_EVENT_STA_DISCONNECTED</a>&gt; arises and the reason-code will be the one specified in the association response. Refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-reason-code">Wi-Fi Reason Code</a>&gt;.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="wi-fi-reason-code">
<h3>Wi-Fi Reason Code<a class="headerlink" href="wifi.html#wi-fi-reason-code" title="Permalink to this headline">¶</a></h3>
<p>The table below shows the reason-code defined in ESP32. The first column is the macro name defined in esp_wifi_types.h. The common prefix <em>WIFI_REASON</em> is removed, which means that <em>UNSPECIFIED</em> actually stands for <em>WIFI_REASON_UNSPECIFIED</em> and so on. The second column is the value of the reason. The third column is the standard value to which this reason is mapped in section 8.4.1.7 of ieee802.11-2012. (For more information, refer to the standard mentioned above.) The last column is a description of the reason.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="7%" />
<col width="9%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Reason code</th>
<th class="head">ESP32
value</th>
<th class="head">Mapped To
Standard
Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>UNSPECIFIED</td>
<td>1</td>
<td>1</td>
<td>Generally, it means an internal failure, e.g., the memory
runs out, the internal TX fails, or the reason is received
from the remote side, etc.</td>
</tr>
<tr class="row-odd"><td>AUTH_EXPIRE</td>
<td>2</td>
<td>2</td>
<td><p class="first">The previous authentication is no longer valid.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>auth is timed out</li>
<li>the reason is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 SoftAP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP has not received any packets from the station
in the past five minutes.</li>
<li>the soft-AP is stopped by calling esp_wifi_stop().</li>
<li>the station is de-authed by calling esp_wifi_deauth_sta()</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>AUTH_LEAVE</td>
<td>3</td>
<td>3</td>
<td><p class="first">De-authenticated, because the sending STA is
leaving (or has left).</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>ASSOC_EXPIRE</td>
<td>4</td>
<td>4</td>
<td><p class="first">Disassociated due to inactivity.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP has not received any packets from the
station in the past five minutes.</li>
<li>the soft-AP is stopped by calling esp_wifi_stop().</li>
<li>the station is de-authed by calling esp_wifi_deauth_sta()</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>ASSOC_TOOMANY</td>
<td>5</td>
<td>5</td>
<td><p class="first">Disassociated, because the AP is unable to handle
all currently associated STAs at the same time.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the stations associated with the soft-AP reach the
maximum number that the soft-AP can support.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>NOT_AUTHED</td>
<td>6</td>
<td>6</td>
<td><p class="first">Class-2 frame received from a non-authenticated STA.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP receives a packet with data from a
non-authenticated station.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>NOT_ASSOCED</td>
<td>7</td>
<td>7</td>
<td><p class="first">Class-3 frame received from a non-associated STA.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP receives a packet with data from a
non-associated station.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>ASSOC_LEAVE</td>
<td>8</td>
<td>8</td>
<td><p class="first">Disassociated, because the sending STA is leaving (or has
left) BSS.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
<li>the station is disconnected by esp_wifi_disconnect() and
other APIs.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>ASSOC_NOT_AUTHED</td>
<td>9</td>
<td>9</td>
<td><p class="first">STA requesting (re)association is not authenticated by the
responding STA.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP receives packets with data from an
associated, yet not authenticated, station.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>DISASSOC_PWRCAP_BAD</td>
<td>10</td>
<td>10</td>
<td><p class="first">Disassociated, because the information in the Power
Capability element is unacceptable.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>DISASSOC_SUPCHAN_BAD</td>
<td>11</td>
<td>11</td>
<td><p class="first">Disassociated, because the information in the Supported
Channels element is unacceptable.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>IE_INVALID</td>
<td>13</td>
<td>13</td>
<td><p class="first">Invalid element, i.e. an element whose content does not meet
the specifications of the Standard in Clause 8.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP</li>
</ul>
</div></blockquote>
<p>For the ESP32 Soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the soft-AP parses a wrong WPA or RSN IE.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>MIC_FAILURE</td>
<td>14</td>
<td>14</td>
<td><p class="first">Message integrity code (MIC) failure.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>4WAY_HANDSHAKE_TIMEOUT</td>
<td>15</td>
<td>15</td>
<td><p class="first">Four-way handshake times out. For legacy reasons, in ESP32
this reason-code is replaced with
WIFI_REASON_HANDSHAKE_TIMEOUT.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>the handshake times out</li>
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>GROUP_KEY_UPDATE_TIMEOUT</td>
<td>16</td>
<td>16</td>
<td><p class="first">Group-Key Handshake times out.</p>
<p>For the ESP32 station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>IE_IN_4WAY_DIFFERS</td>
<td>17</td>
<td>17</td>
<td><p class="first">The element in the four-way handshake is different from the
(Re-)Association Request/Probe and Response/Beacon frame.</p>
<p>For the ESP32 station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
<li>the station finds that the four-way handshake IE differs
from the IE in the (Re-)Association Request/Probe and
Response/Beacon frame.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>GROUP_CIPHER_INVALID</td>
<td>18</td>
<td>18</td>
<td><p class="first">Invalid group cipher.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>PAIRWISE_CIPHER_INVALID</td>
<td>19</td>
<td>19</td>
<td><p class="first">Invalid pairwise cipher.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>AKMP_INVALID</td>
<td>20</td>
<td>20</td>
<td><p class="first">Invalid AKMP.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>UNSUPP_RSN_IE_VERSION</td>
<td>21</td>
<td>21</td>
<td><p class="first">Unsupported RSNE version.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>INVALID_RSN_IE_CAP</td>
<td>22</td>
<td>22</td>
<td><p class="first">Invalid RSNE capabilities.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>802_1X_AUTH_FAILED</td>
<td>23</td>
<td>23</td>
<td><p class="first">IEEE 802.1X. authentication failed.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote>
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
<p>For the ESP32 soft-AP, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>802.1 x authentication fails.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-even"><td>CIPHER_SUITE_REJECTED</td>
<td>24</td>
<td>24</td>
<td><p class="first">Cipher suite rejected due to security policies.</p>
<p>For the ESP32 Station, this reason is reported when:</p>
<blockquote class="last">
<div><ul class="simple">
<li>it is received from the soft-AP.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td>BEACON_TIMEOUT</td>
<td>200</td>
<td>reserved</td>
<td>Espressif-specific Wi-Fi reason-code: when the station
loses N beacons continuously, it will disrupt the connection
and report this reason.</td>
</tr>
<tr class="row-even"><td>NO_AP_FOUND</td>
<td>201</td>
<td>reserved</td>
<td>Espressif-specific Wi-Fi reason-code: when the station
fails to scan the target AP, this reason code will be
reported.</td>
</tr>
<tr class="row-odd"><td>AUTH_FAIL</td>
<td>202</td>
<td>reserved</td>
<td>Espressif-specific Wi-Fi reason-code: the
authentication fails, but not because of a timeout.</td>
</tr>
<tr class="row-even"><td>ASSOC_FAIL</td>
<td>203</td>
<td>reserved</td>
<td>Espressif-specific Wi-Fi reason-code: the association
fails, but not because of ASSOC_EXPIRE or ASSOC_TOOMANY.</td>
</tr>
<tr class="row-odd"><td>HANDSHAKE_TIMEOUT</td>
<td>204</td>
<td>reserved</td>
<td>Espressif-specific Wi-Fi reason-code: the
handshake fails for the same reason as that in
WIFI_REASON_4WAY_HANDSHAKE_TIMEOUT.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="esp32-wi-fi-configuration">
<h2>ESP32 Wi-Fi Configuration<a class="headerlink" href="wifi.html#esp32-wi-fi-configuration" title="Permalink to this headline">¶</a></h2>
<p>All configurations will be stored into flash when the Wi-Fi NVS is enabled; otherwise, refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-nvs-flash">Wi-Fi NVS Flash</a>&gt;.</p>
<div class="section" id="wi-fi-mode">
<h3>Wi-Fi Mode<a class="headerlink" href="wifi.html#wi-fi-mode" title="Permalink to this headline">¶</a></h3>
<p>Call esp_wifi_set_mode() to set the Wi-Fi mode.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WIFI_MODE_NULL</td>
<td>NULL mode: in this mode, the internal data struct is not
allocated to the station and the soft-AP, while both the
station and soft-AP interfaces are not initialized for
RX/TX Wi-Fi data. Generally, this mode is used for Sniffer,
or when you only want to stop both the STA and the AP
without calling esp_wifi_deinit() to unload the whole Wi-Fi
driver.</td>
</tr>
<tr class="row-odd"><td>WIFI_MODE_STA</td>
<td>Station mode: in this mode, esp_wifi_start() will init the
internal station data, while the station&#8217;s interface is ready
for the RX and TX Wi-Fi data. After esp_wifi_connect() is
called, the STA will connect to the target AP.</td>
</tr>
<tr class="row-even"><td>WIFI_MODE_AP</td>
<td>Soft-AP mode: in this mode, esp_wifi_start() will init the
internal soft-AP data, while the soft-AP&#8217;s interface is ready
for RX/TX Wi-Fi data. Then, the Wi-Fi driver starts broad-
casting beacons, and the soft-AP is ready to get connected
to other stations.</td>
</tr>
<tr class="row-odd"><td>WIFI_MODE_APSTA</td>
<td>Station-AP coexistence mode: in this mode, esp_wifi_start()
will simultaneously init both the station and the soft-AP.
This is done in station mode and soft-AP mode. Please note
that the channel of the external AP, which the ESP32 Station
is connected to, has higher priority over the ESP32 Soft-AP
channel. Refer to <a class="reference internal" href="wifi.html#wi-fi-channel-management">Wi-Fi Channel Management</a>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="station-basic-configuration">
<h3>Station Basic Configuration<a class="headerlink" href="wifi.html#station-basic-configuration" title="Permalink to this headline">¶</a></h3>
<p>API esp_wifi_set_config() can be used to configure the station. The table below describes the fields in detail.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ssid</td>
<td>This is the SSID of the target AP, to which the station wants
to connect to.</td>
</tr>
<tr class="row-odd"><td>password</td>
<td>Password of the target AP</td>
</tr>
<tr class="row-even"><td>bssid_set</td>
<td>If bssid_set is 0, the station connects to the AP whose SSID
is the same as the field &#8220;ssid&#8221;, while the field &#8220;bssid&#8221;
is ignored. In all other cases, the station connects to
the AP whose SSID is the same as the &#8220;ssid&#8221; field, while its
BSSID is the same the &#8220;bssid&#8221; field .</td>
</tr>
<tr class="row-odd"><td>bssid</td>
<td>This is valid only when bssid_set is 1; see field
&#8220;bssid_set&#8221;.</td>
</tr>
<tr class="row-even"><td>channel</td>
<td>If the channel is 0, the station scans the channel 1~N to
search for the target AP; otherwise, the station starts by
scanning the channel whose value is the same as that of the
&#8220;channel&#8221; field, and then scans others to find the target AP.
If you do not know which channel the target AP is running on,
set it to 0.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="soft-ap-basic-configuration">
<h3>Soft-AP Basic Configuration<a class="headerlink" href="wifi.html#soft-ap-basic-configuration" title="Permalink to this headline">¶</a></h3>
<p>API esp_wifi_set_config() can be used to configure the soft-AP. The table below describes the fields in detail.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ssid</td>
<td>SSID of soft-AP; if the ssid[0] is 0xFF and ssid[1] is 0xFF,
the soft-AP defaults the SSID to ESP_aabbcc, where &#8220;aabbcc&#8221;
is the last three bytes of the soft-AP MAC.</td>
</tr>
<tr class="row-odd"><td>password</td>
<td>Password of soft-AP; if the auth mode is WIFI_AUTH_OPEN,
this field will be ignored.</td>
</tr>
<tr class="row-even"><td>ssid_len</td>
<td>Length of SSID; if ssid_len is 0, check the SSID until there
is a termination character. If ssid_len &gt; 32, change it to
32; otherwise, set the SSID length according to ssid_len.</td>
</tr>
<tr class="row-odd"><td>channel</td>
<td>Channel of soft-AP; if the channel is out of range, the Wi-Fi
driver defaults the channel to channel 1. So, please make
sure the channel is within the required range.
For more details, refer to &lt;<a class="reference internal" href="wifi.html#channel-range">Channel Range</a>&gt;.</td>
</tr>
<tr class="row-even"><td>authmode</td>
<td>Auth mode of ESP32 soft-AP; currently, ESP32 Wi-Fi does not
support AUTH_WEP. If the authmode is an invalid value,
soft-AP defaults the value to WIFI_AUTH_OPEN.</td>
</tr>
<tr class="row-odd"><td>ssid_hidden</td>
<td>If ssid_hidden is 1, soft-AP does not broadcast the SSID;
otherwise, it does broadcast the SSID.</td>
</tr>
<tr class="row-even"><td>max_connection</td>
<td>Currently, ESP32 Wi-Fi supports up to 10 Wi-Fi connections.
If max_connection &gt; 10, soft-AP defaults the value to 10.</td>
</tr>
<tr class="row-odd"><td>beacon_interval</td>
<td>Beacon interval; the value is 100 ~ 60000 ms, with default
value being 100 ms. If the value is out of range,
soft-AP defaults it to 100 ms.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="wi-fi-protocol-mode">
<h3>Wi-Fi Protocol Mode<a class="headerlink" href="wifi.html#wi-fi-protocol-mode" title="Permalink to this headline">¶</a></h3>
<p>Currently, the IDF supports the following protocol modes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Protocol Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>802.11 B</td>
<td>Call esp_wifi_set_protocol(ifx, WIFI_PROTOCOL_11B) to set
the station/soft-AP to 802.11B-only mode.</td>
</tr>
<tr class="row-odd"><td>802.11 BG</td>
<td>Call esp_wifi_set_protocol(ifx, WIFI_PROTOCOL_11B|WIFI_
PROTOCOL_11G) to set the station/soft-AP to 802.11BG mode.</td>
</tr>
<tr class="row-even"><td>802.11 BGN</td>
<td>Call esp_wifi_set_protocol(ifx, WIFI_PROTOCOL_11B|
WIFI_PROTOCOL_11G|WIFI_PROTOCOL_11N) to set the station/
soft-AP to BGN mode.</td>
</tr>
<tr class="row-odd"><td>802.11 BGNLR</td>
<td>Call esp_wifi_set_protocol(ifx, WIFI_PROTOCOL_11B|
WIFI_PROTOCOL_11G|WIFI_PROTOCOL_11N|WIFI_PROTOCOL_LR)
to set the station/soft-AP to BGN and the
Espressif-specific mode.</td>
</tr>
<tr class="row-even"><td>802.11 LR</td>
<td><p class="first">Call esp_wifi_set_protocol(ifx, WIFI_PROTOCOL_LR) to set
the station/soft-AP only to the Espressif-specific mode.</p>
<p class="last"><strong>This mode is an Espressif-patented mode which can achieve
a one-kilometer line of sight range. Please, make sure both
the station and the soft-AP are connected to an
ESP32 device</strong></p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="wi-fi-channel-management">
<h3>Wi-Fi Channel Management<a class="headerlink" href="wifi.html#wi-fi-channel-management" title="Permalink to this headline">¶</a></h3>
<div class="section" id="channel-range">
<h4>Channel Range<a class="headerlink" href="wifi.html#channel-range" title="Permalink to this headline">¶</a></h4>
<p>Call esp_wifi_set_country() to set the country code which limits the channel range.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Country</th>
<th class="head">Channel Range</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>China</td>
<td>1,2,3 ... 14</td>
</tr>
<tr class="row-odd"><td>Japan</td>
<td>1,2,3 ... 14</td>
</tr>
<tr class="row-even"><td>USA</td>
<td>1,2,3 ... 11</td>
</tr>
<tr class="row-odd"><td>Europe</td>
<td>1,2,3 ... 13</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="home-channel">
<h4>Home Channel<a class="headerlink" href="wifi.html#home-channel" title="Permalink to this headline">¶</a></h4>
<p>In soft-AP mode, the home channel is defined as that of the soft-AP channel. In Station mode, the home channel is defined as the channel of the AP to which the station is connected. In Station+SoftAP mode, the home channel of soft-AP and station must be the same. If the home channels of Station and Soft-AP are different, the station&#8217;s home channel is always in priority. Take the following as an example: at the beginning, the soft-AP is on channel 6, then the station connects to an AP whose channel is 9. Since the station&#8217;s home channel has a higher priority, the soft-AP needs to switch its channel from 6 to 9 to make sure that both station and soft-AP have the same home channel.</p>
</div>
</div>
<div class="section" id="wi-fi-vendor-ie-configuration">
<h3>Wi-Fi Vendor IE Configuration<a class="headerlink" href="wifi.html#wi-fi-vendor-ie-configuration" title="Permalink to this headline">¶</a></h3>
<p>By default, all Wi-Fi management frames are processed by the Wi-Fi driver, and the application does not need to care about them. Some applications, however, may have to handle the beacon, probe request, probe response and other management frames. For example, if you insert some vendor-specific IE into the management frames, it is only the management frames which contain this vendor-specific IE that will be processed. In ESP32, esp_wifi_set_vendor_ie() and esp_wifi_set_vendor_ie_cb() are responsible for this kind of tasks.</p>
</div>
</div>
<div class="section" id="esp32-wi-fi-power-saving-mode">
<h2>ESP32 Wi-Fi Power-saving Mode<a class="headerlink" href="wifi.html#esp32-wi-fi-power-saving-mode" title="Permalink to this headline">¶</a></h2>
<p>Currently, ESP32 Wi-Fi supports the Modem-sleep mode which refers to WMM (Wi-Fi Multi Media) power-saving mode in the IEEE 802.11 protocol. If the Modem-sleep mode is enabled and the Wi-Fi enters a sleep state, then, RF, PHY and BB are turned off in order to reduce power consumption. Modem-sleep mode works in Station-only mode and the station must be connected to the AP first.</p>
<p>Call esp_wifi_set_ps(WIFI_PS_MODEM) to enable Modem-sleep mode after calling esp_wifi_init(). About 10 seconds after the station connects to the AP, Modem-sleep will start. When the station disconnects from the AP, Modem-sleep will stop.</p>
</div>
<div class="section" id="esp32-wi-fi-connect-crypto">
<h2>ESP32 Wi-Fi Connect Crypto<a class="headerlink" href="wifi.html#esp32-wi-fi-connect-crypto" title="Permalink to this headline">¶</a></h2>
<p>Now ESP32 have two group crypto functions can be used when do wifi connect, one is the original functions, the other is optimized by ESP hardware:
1. Original functions which is the source code used in the folder components/wpa_supplicant/src/crypto function;
2. The optimized functions is in the folder components/wpa_supplicant/src/fast_crypto, these function used the hardware crypto to make it faster than origin one, the type of function&#8217;s name add <cite>fast_</cite> to distinguish with the original one. For example, the API aes_wrap() is used to encrypt frame information when do 4 way handshake, the fast_aes_wrap() has the same result but can be faster.</p>
<p>Two groups of crypto function can be used when register in the wpa_crypto_funcs_t, wpa2_crypto_funcs_t and wps_crypto_funcs_t structure, also we have given the recommend functions to register in the
fast_crypto_ops.c, you can register the function as the way you need, however what should make action is that the crypto_hash_xxx function and crypto_cipher_xxx function need to register with the same function to operation. For example, if you register crypto_hash_init() function to initialize the esp_crypto_hash structure, you need use the crypto_hash_update() and crypto_hash_finish() function to finish the operation, rather than fast_crypto_hash_update() or fast_crypto_hash_finish().</p>
</div>
<div class="section" id="esp32-wi-fi-throughput">
<h2>ESP32 Wi-Fi Throughput<a class="headerlink" href="wifi.html#esp32-wi-fi-throughput" title="Permalink to this headline">¶</a></h2>
<p>The table below shows the best throughput results we got in Espressif&#8217;s lab and in a shield box.</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type/Throughput</th>
<th class="head">Air In Lab</th>
<th class="head">Shield-box</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Raw 802.11 Packet RX</td>
<td>N/A</td>
<td><strong>130 MBit/sec</strong></td>
</tr>
<tr class="row-odd"><td>Raw 802.11 Packet TX</td>
<td>N/A</td>
<td><strong>130 MBit/sec</strong></td>
</tr>
<tr class="row-even"><td>UDP RX</td>
<td>30 MBit/sec</td>
<td>80 MBit/sec</td>
</tr>
<tr class="row-odd"><td>UDP TX</td>
<td>30 MBit/sec</td>
<td>80 MBit/sec</td>
</tr>
<tr class="row-even"><td>TCP RX</td>
<td>20 MBit/sec</td>
<td>25 MBit/sec</td>
</tr>
<tr class="row-odd"><td>TCP TX</td>
<td>20 MBit/sec</td>
<td>25 MBit/sec</td>
</tr>
</tbody>
</table>
<p>The throughput result heavily depends on hardware and software configurations, such as CPU frequency, memory configuration, or whether the CPU is running in dual-core mode, etc. The table below shows the configurations with which we got the above-mentioned throughput results. In ESP32 IDF, the default configuration is based on &#8220;very conservative&#8221; calculations, so if you want to get the best throughput result, the first thing you need to do is to adjust the relevant configurations.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="30%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Value</th>
<th class="head">How to configure</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CPU Core Mode</td>
<td>Dual Core</td>
<td>Menuconfig</td>
</tr>
<tr class="row-odd"><td>CPU Frequency</td>
<td>240 MHz</td>
<td>Menuconfig</td>
</tr>
<tr class="row-even"><td>Static RX Buffer</td>
<td>15</td>
<td>Menuconfig</td>
</tr>
<tr class="row-odd"><td>Dynamic RX Buffer</td>
<td>Unlimited</td>
<td>Menuconfig</td>
</tr>
<tr class="row-even"><td>Dynamic TX Buffer</td>
<td>Unlimited</td>
<td>Menuconfig</td>
</tr>
<tr class="row-odd"><td>TCP RX Window</td>
<td>12*1460 Bytes</td>
<td><p class="first">Release 2.1/2.0 and earlier:
TCP_WND_DEFAULT in lwipopts.h</p>
<p class="last">After the 2.1 Release:
Menuconfig</p>
</td>
</tr>
<tr class="row-even"><td>TCP TX Window</td>
<td>12*1460 Bytes</td>
<td><p class="first">Release 2.1/2.0 and earlier:
TCP_SND_BUF_DEFAULT in
lwipopts.h</p>
<p class="last">After the 2.1 Release:
Menuconfig</p>
</td>
</tr>
<tr class="row-odd"><td>TCP RX MBOX</td>
<td>12</td>
<td><p class="first">Release 2.1/2.0 and earlier:
DEFAULT_TCP_RECVMBOX_SIZE in
lwipopts.h</p>
<p class="last">After the 2.1 Release:
Menuconfig</p>
</td>
</tr>
<tr class="row-even"><td>RX BA Window</td>
<td>9~16</td>
<td><p class="first">Release 2.1/2.0 and earlier:
not configurable</p>
<p class="last">After the 2.1 Release:
Menuconfig</p>
</td>
</tr>
<tr class="row-odd"><td>TX BA Window</td>
<td>9~16</td>
<td><p class="first">Release 2.1/2.0 and earlier:
not configurable</p>
<p class="last">After the 2.1 Release:
Menuconfig</p>
</td>
</tr>
</tbody>
</table>
<p>Once you adjust the configurations, you can then run your own test code to test the performance. You can also run the iperf example to test the performance. However, the iperf example is not provided in release 2.1 and earlier ones, but will be so in the upcoming release. Those who really care about the performance should seek support from Espressif directly, so that we can provide them with the iperf version bin for their testing.</p>
<p>If you decide to modify some of the configurations in order to gain better throughput for your application, please consider the memory usage very carefully. For a  more detailed description, refer to &lt;<a class="reference internal" href="wifi.html#wi-fi-buffer-usage">Wi-Fi Buffer Usage</a>&gt; and &lt;<a class="reference internal" href="wifi.html#wi-fi-buffer-configure">Wi-Fi Buffer Configure</a>&gt;.</p>
</div>
<div class="section" id="wi-fi-80211-packet-send">
<h2>Wi-Fi 80211 Packet Send<a class="headerlink" href="wifi.html#wi-fi-80211-packet-send" title="Permalink to this headline">¶</a></h2>
<p><strong>Important notes: The API esp_wifi_80211_tx is not available in IDF 2.1, but will be so in the upcoming release.</strong></p>
<p>The esp_wifi_80211_tx API can be used to:</p>
<blockquote>
<div><ul class="simple">
<li>Send the beacon, probe request, probe response, action frame.</li>
<li>Send the QoS and non-QoS data frame.</li>
</ul>
</div></blockquote>
<p>It cannot be used for sending cryptographic frames.</p>
<div class="section" id="parameters-of-esp-wifi-80211-tx">
<h3>Parameters of esp_wifi_80211_tx<a class="headerlink" href="wifi.html#parameters-of-esp-wifi-80211-tx" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ifx</td>
<td>Wi-Fi interface ID: if the Wi-Fi mode is Station,
the ifx should be WIFI_IF_STA. If the Wi-Fi
mode is SoftAP, the ifx should be WIFI_IF_AP. If
the Wi-Fi mode is Station+SoftAP, the ifx should
be WIFI_IF_STA or WIFI_IF_AP.
If the ifx is wrong, the API returns
ESP_ERR_WIFI_IF.</td>
</tr>
<tr class="row-odd"><td>buffer</td>
<td><p class="first">Raw 802.11 buffer. For building the correct
buffer, refer to the following sections:</p>
<p class="last">If the buffer is wrong, or violates the Wi-Fi
driver&#8217;s restrictions, the API returns
ESP_ERR_WIFI_ARG or results in unexpected
behavior. <strong>Please read the following section
carefully to make sure you understand the
restrictions on encapsulating the buffer.</strong></p>
</td>
</tr>
<tr class="row-even"><td>len</td>
<td>The length must be &lt;= 1500; otherwise, the API
will return ESP_ERR_WIFI_ARG.</td>
</tr>
<tr class="row-odd"><td>en_sys_seq</td>
<td>If en_sys_seq is true, it means that the Wi-Fi
driver will rewrite the sequence number in the
buffer; otherwise, it will not rewrite the
sequence number.
Generally, if esp_wifi_80211_tx is called before
the Wi-Fi connection has been set up, both
en_sys_seq==true and en_sys_seq==false are fine.
However, if the API is called after the Wi-Fi
connection has been set up, en_sys_seq should be
true. For more details, read the following section
about the sequence configuration.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="preconditions-of-using-esp-wifi-80211-tx">
<h3>Preconditions of Using esp_wifi_80211_tx<a class="headerlink" href="wifi.html#preconditions-of-using-esp-wifi-80211-tx" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>The Wi-Fi mode is Station, or SoftAP, or Station+SoftAP.</li>
<li>Either esp_wifi_set_promiscuous(true), or esp_wifi_start(), or both of these APIs return ESP_ERR_WIFI_OK. This is because we need to make sure that Wi-Fi hardware is initialized before esp_wifi_80211_tx() is called. In ESP32, both esp_wifi_set_promiscuous(true) and esp_wifi_start() can trigger the initialization of Wi-Fi hardware.</li>
<li>The parameters of esp_wifi_80211_tx are hereby correctly provided.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="side-effects-to-avoid-in-different-scenarios">
<h3>Side-Effects to Avoid in Different Scenarios<a class="headerlink" href="wifi.html#side-effects-to-avoid-in-different-scenarios" title="Permalink to this headline">¶</a></h3>
<p>Theoretically, if we do not consider the side-effects the API imposes on the Wi-Fi driver or other stations/soft-APs, we can send a raw 802.11 packet over the air, with any destination MAC, any source MAC, any BSSID, or any other type of packet. However,robust/useful applications should avoid such side-effects. The table below provides some tips/recommendations on how to avoid the side-effects of esp_wifi_80211_tx in different scenarios.</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Scenario</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><p class="first">NO_CONN_MGMT</p>
<blockquote class="last">
<div><ul class="simple">
<li>No Wi-Fi connection</li>
<li>Can send management frame</li>
</ul>
</div></blockquote>
</td>
<td><p class="first">In this scenario, no Wi-Fi connection is set up,
so there are no side-effects on the Wi-Fi driver.
If en_sys_seq==true, the Wi-Fi driver is
responsible for the sequence control. If
en_sys_seq==false, the application needs to ensure
that the buffer has the correct sequence.</p>
<p>Theoretically, the MAC address can be any address.
However, this may impact other stations/soft-APs
with the same MAC/BSSID.</p>
<p>Side-effect example#1
The application calls esp_wifi_80211_tx to send
a beacon with BSSID == mac_x in SoftAP mode, but
the mac_x is not the MAC of the SoftAP interface.
Moreover, there is another soft-AP, say
&#8220;other-AP&#8221;, whose bssid is mac_x. If this
happens, an &#8220;unexpected behavior&#8221; may occur,
because the stations which connect to the
&#8220;other-AP&#8221; cannot figure out whether the beacon is
from the &#8220;other-AP&#8221; or the esp_wifi_80211_tx.</p>
<p>To avoid the above-mentioned side-effects, we
recommend that:</p>
<blockquote>
<div><ul class="simple">
<li>If esp_wifi_80211_tx is called in Station mode,
the first MAC should be a multicast MAC or the
exact target-device&#8217;s MAC, while the second MAC
should be that of the station interface.</li>
<li>If esp_wifi_80211_tx is called in SoftAP mode,
the first MAC should be a multicast MAC or the
exact target-device&#8217;s MAC, while the second MAC
should be that of the soft-AP interface.</li>
</ul>
</div></blockquote>
<p class="last">The recommendations above are only for avoiding
side-effects and can be ignored when there are
good reasons for doing this.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first">NO_CONN_NON_QOS</p>
<blockquote class="last">
<div><ul class="simple">
<li>No Wi-Fi connection</li>
<li>Can send non-QoS frame</li>
</ul>
</div></blockquote>
</td>
<td>Same as in NO_CONN_MGMT</td>
</tr>
<tr class="row-even"><td><p class="first">NO_CONN_QOS</p>
<blockquote class="last">
<div><ul class="simple">
<li>No Wi-Fi connection</li>
<li>Can send QoS frame</li>
</ul>
</div></blockquote>
</td>
<td>Same as in NO_CONN_MGMT</td>
</tr>
<tr class="row-odd"><td><p class="first">CONN_MGMT</p>
<blockquote class="last">
<div><ul class="simple">
<li>Have Wi-Fi connection</li>
<li>Send management frame
only</li>
</ul>
</div></blockquote>
</td>
<td>When the Wi-Fi connection is already set up, and
the sequence is controlled by the application, the
latter may impact the sequence control of the
Wi-Fi connection, as a whole. So, the
recommendation is that en_sys_seq be true.
The MAC-address recommendations in the
NO_CONN_MGMT scenario also apply to the CONN_MGMT
scenario.</td>
</tr>
<tr class="row-even"><td><p class="first">CONN_NON_QOS</p>
<blockquote class="last">
<div><ul class="simple">
<li>Have Wi-Fi connection</li>
<li>Can send non-QoS frame</li>
</ul>
</div></blockquote>
</td>
<td><p class="first">Generally, we should use a socket API, instead of
this one, in order to send the data frame when
the Wi-Fi connection is already set up.</p>
<p class="last">However, if you have any special reasons for using
this particular API, then en_sys_seq must be true;
otherwise, you  may impact the internal sequence
control of the Wi-Fi connection described
in CONN_MGMT.
The MAC-address recommendations in the
NO_CONN_MGMT scenario also apply to the CONN_MGMT
scenario.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first">CONN_QOS</p>
<blockquote class="last">
<div><ul class="simple">
<li>Have Wi-Fi connection</li>
<li>Can send non-QoS frame</li>
</ul>
</div></blockquote>
</td>
<td>Same as in CONN_NON_QOS</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wi-fi-sniffer-mode">
<h2>Wi-Fi Sniffer Mode<a class="headerlink" href="wifi.html#wi-fi-sniffer-mode" title="Permalink to this headline">¶</a></h2>
<p>The Wi-Fi sniffer mode can be enabled by esp_wifi_set_promiscuous(). If the sniffer mode is enabled, the following packets <strong>can</strong> be dumped to the application:</p>
<blockquote>
<div><ul class="simple">
<li>802.11 Management frame</li>
<li>802.11 Data frame, including MPDU, AMPDU, AMSDU, etc.</li>
<li>802.11 MIMO frame, for MIMO frame, the sniffer only dumps the length of the frame.</li>
</ul>
</div></blockquote>
<p>The following packets will <strong>NOT</strong> be dumped to the application:</p>
<blockquote>
<div><ul class="simple">
<li>802.11 Control frame</li>
<li>802.11 error frame, such as the frame with a CRC error, etc.</li>
</ul>
</div></blockquote>
<p>For frames that the sniffer <strong>can</strong> dump, the application can additionally decide which specific type of packets can be filtered to the application by using esp_wifi_set_promiscuous_filter(). By default, it will filter all 802.11 data and management frames to the application.</p>
<p>The Wi-Fi sniffer mode can be enabled in the Wi-Fi mode of WIFI_MODE_NULL, or WIFI_MODE_STA, or WIFI_MODE_AP, or WIFI_MODE_APSTA. In other words, the sniffer mode is active when the station is connected to the soft-AP, or when the soft-AP has a Wi-Fi connection. Please note that the sniffer has a <strong>great impact</strong> on the throughput of the station or soft-AP Wi-Fi connection. Generally, we should <strong>NOT</strong> enable the sniffer, when the station/soft-AP Wi-Fi connection experiences heavy traffic unless we have special reasons.</p>
<p>Another noteworthy issue about the sniffer is the callback wifi_promiscuous_cb_t. The callback will be called directly in the Wi-Fi driver task, so if the application has a lot of work to do for each filtered packet, the recommendation is to post an event to the application task in the callback and defer the real work to the application task.</p>
</div>
<div class="section" id="wi-fi-buffer-usage">
<h2>Wi-Fi Buffer Usage<a class="headerlink" href="wifi.html#wi-fi-buffer-usage" title="Permalink to this headline">¶</a></h2>
<p>This section is only about the dynamic buffer configuration.</p>
<div class="section" id="why-buffer-configuration-is-important">
<h3>Why Buffer Configuration Is Important<a class="headerlink" href="wifi.html#why-buffer-configuration-is-important" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>In order to get a robust, high-performance system, we need to consider the memory usage/configuration very carefully, because:</dt>
<dd><ul class="first last simple">
<li>the available memory in ESP32 is limited.</li>
<li>currently, the default type of buffer in LwIP and Wi-Fi drivers is &#8220;dynamic&#8221;, <strong>which means that both the LwIP and Wi-Fi share memory with the application</strong>. Programmers should always keep this in mind; otherwise, they will face a memory issue, such as &#8220;running out of heap memory&#8221;.</li>
<li>it is very dangerous to run out of heap memory, as this will cause ESP32 an &#8220;undefined behavior&#8221;. Thus, enough heap memory should be reserved for the application, so that it never runs out of it.</li>
<li>the Wi-Fi throughput heavily depends on memory-related configurations, such as the TCP window size, Wi-Fi RX/TX dynamic buffer number, etc. Refer to &lt;<a class="reference internal" href="wifi.html#esp32-wi-fi-throughput">ESP32 Wi-Fi Throughput</a>&gt;.</li>
<li>the peak heap memory that the ESP32 LwIP/Wi-Fi may consume depends on a number of factors, such as the maximum TCP/UDP connections that the application may have, etc.</li>
<li>the total memory that the application requires is also an important factor when considering memory configuration.</li>
</ul>
</dd>
</dl>
<p>Due to these reasons, there is not a good-for-all application configuration. Rather, we have to consider memory configurations separately for every different application.</p>
</div>
<div class="section" id="dynamic-vs-static-buffer">
<h3>Dynamic vs. Static Buffer<a class="headerlink" href="wifi.html#dynamic-vs-static-buffer" title="Permalink to this headline">¶</a></h3>
<p>The default type of buffer in LwIP and Wi-Fi drivers is &#8220;dynamic&#8221;. Most of the time the dynamic buffer can significantly save memory. However, it makes the application programming a little more difficult, because in this case the application needs to consider memory usage in LwIP/Wi-Fi.</p>
</div>
<div class="section" id="peak-lwip-dynamic-buffer">
<h3>Peak LwIP Dynamic Buffer<a class="headerlink" href="wifi.html#peak-lwip-dynamic-buffer" title="Permalink to this headline">¶</a></h3>
<p>The default type of LwIP buffer is &#8220;dynamic&#8221;, and this section considers the dynamic buffer only.
The peak heap memory that LwIP consumes is the <strong>theoretically-maximum memory</strong> that the LwIP driver consumes. Generally, the peak heap memory that the LwIP consumes depends on:</p>
<blockquote>
<div><ul class="simple">
<li>the memory required to create a UDP connection: lwip_udp_conn</li>
<li>the memory required to create a TCP connection: lwip_tcp_conn</li>
<li>the number of UDP connections that the application has: lwip_udp_con_num</li>
<li>the number of TCP connections that the application has: lwip_tcp_con_num</li>
<li>the TCP TX window size: lwip_tcp_tx_win_size</li>
<li>the TCP RX window size: lwip_tcp_rx_win_size</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt><strong>So, the peak heap memory that the LwIP consumes can be calculated with the following formula:</strong></dt>
<dd>lwip_dynamic_peek_memory =  (lwip_udp_con_num * lwip_udp_conn)  + (lwip_tcp_con_num * (lwip_tcp_tx_win_size + lwip_tcp_rx_win_size + lwip_tcp_conn))</dd>
</dl>
<p>Some TCP-based applications need only one TCP connection. However, they may choose to close this TCP connection and create a new one when an error (such as a sending failure) occurs. This may result in multiple TCP connections existing in the system simultaneously, because it may take a long time for a TCP connection to close, according to the TCP state machine (refer to RFC793).</p>
</div>
<div class="section" id="peak-wi-fi-dynamic-buffer">
<h3>Peak Wi-Fi Dynamic Buffer<a class="headerlink" href="wifi.html#peak-wi-fi-dynamic-buffer" title="Permalink to this headline">¶</a></h3>
<p>The Wi-Fi driver supports several types of buffer (refer to <a class="reference internal" href="wifi.html#wi-fi-buffer-configure">Wi-Fi Buffer Configure</a>). However, this section is about the usage of the dynamic Wi-Fi buffer only.
The peak heap memory that Wi-Fi consumes is the <strong>theoretically-maximum memory</strong> that the Wi-Fi driver consumes. Generally, the peak memory depends on:</p>
<blockquote>
<div><ul class="simple">
<li>the number of dynamic rx buffers that are configured: wifi_rx_dynamic_buf_num</li>
<li>the number of dynamic tx buffers that are configured: wifi_tx_dynamic_buf_num</li>
<li>the maximum packet size that the Wi-Fi driver can receive: wifi_rx_pkt_size_max</li>
<li>the maximum packet size that the Wi-Fi driver can send: wifi_tx_pkt_size_max</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>So, the peak memory that the Wi-Fi driver consumes can be calculated with the following formula:</dt>
<dd>wifi_dynamic_peek_memory = (wifi_rx_dynamic_buf_num * wifi_rx_pkt_size_max) + (wifi_tx_dynamic_buf_num * wifi_tx_pkt_size_max)</dd>
</dl>
<p>Generally, we do not need to care about the dynamic tx long buffers and dynamic tx long long buffers, because they are management frames which only have a small impact on the system.</p>
</div>
</div>
<div class="section" id="wi-fi-menuconfig">
<h2>Wi-Fi Menuconfig<a class="headerlink" href="wifi.html#wi-fi-menuconfig" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wi-fi-buffer-configure">
<h3>Wi-Fi Buffer Configure<a class="headerlink" href="wifi.html#wi-fi-buffer-configure" title="Permalink to this headline">¶</a></h3>
<p>If you are going to modify the default number or type of buffer, it would be helpful to also have an overview of how the buffer is allocated/freed in the data path. The following diagram shows this process in the TX direction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>
<span class="o">|</span> <span class="n">Application</span> <span class="o">|</span>            <span class="o">|</span>    <span class="n">LwIP</span>     <span class="o">|</span>            <span class="o">|</span>    <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span> <span class="o">---------&gt;</span> <span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span> <span class="o">---------&gt;</span> <span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span>
 <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>
  <span class="mi">1</span><span class="o">&gt;</span> <span class="n">User</span> <span class="n">data</span>               <span class="mi">2</span><span class="o">&gt;</span> <span class="n">Pbuf</span>                    <span class="mi">3</span><span class="o">&gt;</span> <span class="n">Dynamic</span> <span class="p">(</span><span class="n">Static</span><span class="p">)</span> <span class="n">TX</span> <span class="n">Buffer</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Description:</dt>
<dd><ul class="first last simple">
<li>The application allocates the data which needs to be sent out.</li>
<li>The application calls TCPIP-/Socket-related APIs to send the user data. These APIs will allocate a PBUF used in LwIP, and make a copy of the user data.</li>
<li>When LwIP calls a Wi-Fi API to send the PBUF, the Wi-Fi API will allocate a &#8220;Dynamic Tx Buffer&#8221; or &#8220;Static Tx Buffer&#8221;, make a copy of the LwIP PBUF, and finally send the data.</li>
</ul>
</dd>
</dl>
<p>The following diagram shows how buffer is allocated/freed in the RX direction:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>
<span class="o">|</span> <span class="n">Application</span> <span class="o">|</span>            <span class="o">|</span>    <span class="n">LwIP</span>     <span class="o">|</span>            <span class="o">|</span>    <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>    <span class="o">|</span>            <span class="o">|</span>    <span class="n">Wi</span><span class="o">-</span><span class="n">Fi</span>    <span class="o">|</span>
<span class="o">|</span>    <span class="n">Task</span>     <span class="o">|</span> <span class="o">&lt;---------</span> <span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span> <span class="o">&lt;---------</span> <span class="o">|</span>    <span class="n">task</span>     <span class="o">|</span> <span class="o">&lt;---------</span> <span class="o">|</span>  <span class="n">Interrupt</span>  <span class="o">|</span>
 <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>              <span class="o">-------------</span>
  <span class="mi">4</span><span class="o">&gt;</span> <span class="n">User</span> <span class="n">data</span>               <span class="mi">3</span><span class="o">&gt;</span> <span class="n">Pbuf</span>                    <span class="mi">2</span><span class="o">&gt;</span> <span class="n">Dynamic</span> <span class="n">RX</span> <span class="n">Buffer</span>       <span class="mi">1</span><span class="o">&gt;</span> <span class="n">Static</span> <span class="n">RX</span> <span class="n">Buffer</span>
</pre></div>
</div>
<p>Description:</p>
<blockquote>
<div><ul class="simple">
<li>The  Wi-Fi hardware receives a packet over the air and puts the packet content to the &#8220;Static Rx Buffer&#8221;, which is also called &#8220;RX DMA Buffer&#8221;.</li>
<li>The Wi-Fi driver allocates a &#8220;Dynamic Rx Buffer&#8221;, makes a copy of the &#8220;Static Rx Buffer&#8221;, and returns the &#8220;Static Rx Buffer&#8221; to hardware.</li>
<li>The Wi-Fi driver delivers the packet to the upper-layer (LwIP), and allocates a PBUF for holding the &#8220;Dynamic Rx Buffer&#8221;.</li>
<li>The application receives data from LwIP.</li>
</ul>
</div></blockquote>
<p>The diagram shows the configuration of the Wi-Fi internal buffer.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="13%" />
<col width="13%" />
<col width="15%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Buffer Type</th>
<th class="head">Alloc Type</th>
<th class="head">Default</th>
<th class="head">Configurable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Static RX Buffer
(Hardware RX
Buffer)</td>
<td>Static</td>
<td>10  *
1600 Bytes</td>
<td>Yes</td>
<td>This is a kind of DMA memory. It is
initialized in esp_wifi_init() and
freed in esp_wifi_deinit(). The
&#8216;Static Rx Buffer&#8217; forms the hardware
receiving list. Upon receiving a frame
over the air, hardware writes the
frame into the buffer and raises an
interrupt to the CPU. Then, the Wi-Fi
driver reads the content from the
buffer and returns the buffer back to
the list.</td>
</tr>
<tr class="row-odd"><td>Dynamic RX Buffer</td>
<td>Dynamic</td>
<td>32</td>
<td>Yes</td>
<td>The buffer length is variable and it
depends on the received frames&#8217;
length. When the Wi-Fi driver receives
a frame from the &#8216;Hardware Rx Buffer&#8217;,
the &#8216;Dynamic Rx Buffer&#8217; needs to be
allocated from the heap. The number of
the Dynamic Rx Buffer, configured in
the menuconfig, is used to limit the
total un-freed Dynamic Rx Buffer
number.</td>
</tr>
<tr class="row-even"><td>Dynamic TX Buffer</td>
<td>Dynamic</td>
<td>32</td>
<td>Yes</td>
<td><p class="first">This is a kind of DMA memory. It is
allocated to the heap. When the upper-
layer (LwIP) sends packets to the
Wi-Fi driver, it firstly allocates a
&#8216;Dynamic TX Buffer&#8217; and makes a copy
of the upper-layer buffer.</p>
<p class="last">The Dynamic and Static TX Buffers are
mutually exclusive.</p>
</td>
</tr>
<tr class="row-odd"><td>Static TX Buffer</td>
<td>Static</td>
<td>32 *
1600Bytes</td>
<td>Yes</td>
<td>This is a kind of DMA memory. It is
initialized in esp_wifi_init() and
freed in esp_wifi_deinit().
When the upper-layer (LwIP) sends
packets to the Wi-Fi driver, it
firstly allocates a &#8216;Static TX Buffer&#8217;
and makes a copy of the upper-layer
buffer.
The Dynamic and Static TX Buffer are
mutually exclusive.</td>
</tr>
<tr class="row-even"><td><dl class="first last docutils">
<dt>Management Short</dt>
<dd>Buffer</dd>
</dl>
</td>
<td>Static</td>
<td>16</td>
<td>NO</td>
<td>Wi-Fi driver&#8217;s internal buffer</td>
</tr>
<tr class="row-odd"><td><dl class="first last docutils">
<dt>Management Long</dt>
<dd>Buffer</dd>
</dl>
</td>
<td>Dynamic</td>
<td>32</td>
<td>NO</td>
<td>Wi-Fi driver&#8217;s internal buffer</td>
</tr>
<tr class="row-even"><td><dl class="first last docutils">
<dt>Mgmt Long Long</dt>
<dd>Buffer</dd>
</dl>
</td>
<td>Dynamic</td>
<td>32</td>
<td>NO</td>
<td>Wi-Fi driver&#8217;s internal buffer</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="wi-fi-nvs-flash">
<h3>Wi-Fi NVS Flash<a class="headerlink" href="wifi.html#wi-fi-nvs-flash" title="Permalink to this headline">¶</a></h3>
<p>If the Wi-Fi NVS flash is enabled, all Wi-Fi configurations set via the Wi-Fi APIs will be stored into flash, and the Wi-Fi driver will start up with these configurations next time it powers on/reboots. However, the application can choose to disable the Wi-Fi NVS flash if it does not need to store the configurations into persistent memory, or has its own persistent storage, or simply due to debugging reasons, etc.</p>
</div>
<div class="section" id="wi-fi-ampdu">
<h3>Wi-Fi AMPDU<a class="headerlink" href="wifi.html#wi-fi-ampdu" title="Permalink to this headline">¶</a></h3>
<p>Generally, the AMPDU should be enabled, because it can greatly improve the Wi-Fi throughput. Disabling AMPDU is usually for debugging purposes. It may be removed from future releases.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="external-ram.html" class="btn btn-neutral float-right" title="Support for external RAM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="romconsole.html" class="btn btn-neutral" title="ESP32 ROM console" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2017, Espressif.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v3.0-dev-806-gde750e9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>