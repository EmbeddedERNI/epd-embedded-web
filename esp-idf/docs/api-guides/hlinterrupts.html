

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>High-Level Interrupts &mdash; ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation" href="../index.html"/>
        <link rel="up" title="API Guides" href="index.html"/>
        <link rel="next" title="JTAG Debugging" href="jtag-debugging/index.html"/>
        <link rel="prev" title="ESP-IDF FreeRTOS SMP Changes" href="freertos-smp.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
          </a>

          
            
            
              <div class="version">
                v3.0-dev-806-gde750e9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="hlinterrupts.html#">High Level Interrupts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hlinterrupts.html#interrupt-levels">Interrupt Levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="hlinterrupts.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="ulp.html">ULP Coprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>High-Level Interrupts</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api-guides/hlinterrupts.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="high-level-interrupts">
<h1>High-Level Interrupts<a class="headerlink" href="hlinterrupts.html#high-level-interrupts" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The Xtensa architecture has support for 32 interrupts, divided over 8 levels, plus an assortment of exceptions. On the ESP32, the interrupt mux allows most interrupt sources to be routed to these interrupts using the <a class="reference internal" href="../api-reference/system/intr_alloc.html"><span class="doc">interrupt allocator</span></a>. Normally, interrupts will be written in C, but ESP-IDF allows high-level interrupts to be written in assembly as well, allowing for very low interrupt latencies.</p>
<div class="section" id="interrupt-levels">
<h2>Interrupt Levels<a class="headerlink" href="hlinterrupts.html#interrupt-levels" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="23%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Level</th>
<th class="head">Symbol</th>
<th class="head">Remark</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>N/A</td>
<td>Exception and level 0 interrupts. Handled by ESP-IDF</td>
</tr>
<tr class="row-odd"><td>2-3</td>
<td>N/A</td>
<td>Medium level interrupts. Handled by ESP-IDF</td>
</tr>
<tr class="row-even"><td>4</td>
<td>xt_highint4</td>
<td>Normally used by ESP-IDF debug logic</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>xt_highint5</td>
<td>Free to use</td>
</tr>
<tr class="row-even"><td>NMI</td>
<td>xt_nmi</td>
<td>Free to use</td>
</tr>
<tr class="row-odd"><td>dbg</td>
<td>xt_debugexception</td>
<td>Debug exception. Called on e.g. a BREAK instruction.</td>
</tr>
</tbody>
</table>
<p>Using these symbols is done by creating an assembly file (suffix .S) and defining the named symbols, like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">iram1</span><span class="p">,</span><span class="s2">&quot;ax&quot;</span>
    <span class="o">.</span><span class="k">global</span>     <span class="n">xt_highint5</span>
    <span class="o">.</span><span class="n">type</span>       <span class="n">xt_highint5</span><span class="p">,</span><span class="nd">@function</span>
    <span class="o">.</span><span class="n">align</span>      <span class="mi">4</span>
<span class="n">xt_highint5</span><span class="p">:</span>
    <span class="o">...</span> <span class="n">your</span> <span class="n">code</span> <span class="n">here</span>
    <span class="n">rsr</span>     <span class="n">a0</span><span class="p">,</span> <span class="n">EXCSAVE_5</span>
    <span class="n">rfi</span>     <span class="mi">5</span>
</pre></div>
</div>
<p>For a real-life example, see the components/esp32/panic_highint_hdl.S file; the panic handler iunterrupt is implemented there.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="hlinterrupts.html#notes" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">Do not call C code from a high-level interrupt; because these interupts still run in critical sections, this can cause crashes.
(The panic handler interrupt does call normal C code, but this is OK because there is no intention of returning to the normal code
flow afterwards.)</p>
</li>
<li><p class="first">Make sure your assembly code gets linked in. If the interrupt handler symbol is the only symbol the rest of the code uses from this
file, the linker will take the default ISR instead and not link the assembly file into the final project. To get around this, in the
assembly file, define a symbol, like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="o">.</span><span class="k">global</span> <span class="n">ld_include_my_isr_file</span>
<span class="n">ld_include_my_isr_file</span><span class="p">:</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>(The symbol is called <code class="docutils literal"><span class="pre">ld_include_my_isr_file</span></code> here but can have any arbitrary name not defined anywhere else.)
Then, in the component.mk, add this file as an unresolved symbol to the ld command line arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">COMPONENT_ADD_LDFLAGS</span> <span class="p">:</span><span class="o">=</span> <span class="o">-</span><span class="n">u</span> <span class="n">ld_include_my_isr_file</span>
</pre></div>
</div>
<p>This should cause the linker to always include a file defining <code class="docutils literal"><span class="pre">ld_include_my_isr_file</span></code>, causing the ISR to always be linked in.</p>
<blockquote>
<div><ul class="simple">
<li>High-level interrupts can be routed and handled using esp_intr_alloc and associated functions. The handler and handler arguments
to esp_intr_alloc must be NULL, however.</li>
<li>In theory, medium priority interrupts could also be handled in this way. For now, ESP-IDF does not support this.</li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="jtag-debugging/index.html" class="btn btn-neutral float-right" title="JTAG Debugging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="freertos-smp.html" class="btn btn-neutral" title="ESP-IDF FreeRTOS SMP Changes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2017, Espressif.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v3.0-dev-806-gde750e9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>