

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ULP coprocessor programming &mdash; ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="ESP-IDF Programming Guide v3.0-dev-806-gde750e9 documentation" href="../index.html"/>
        <link rel="up" title="API Guides" href="index.html"/>
        <link rel="next" title="ULP coprocessor instruction set" href="ulp_instruction_set.html"/>
        <link rel="prev" title="Secure Boot" href="../security/secure-boot.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ESP-IDF Programming Guide
          

          
          </a>

          
            
            
              <div class="version">
                v3.0-dev-806-gde750e9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">H/W Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general-notes.html">General Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep Sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">ESP32 Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/flash-encryption.html">Flash Encryption</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos-smp.html">FreeRTOS SMP Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Level Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/secure-boot.html">Secure Boot</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="ulp.html#">ULP Coprocessor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ulp_instruction_set.html">Instruction set reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp_macros.html">Programming using macros (legacy)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html#installing-the-toolchain">Installing the toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html#compiling-ulp-code">Compiling ULP code</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html#accessing-ulp-program-variables">Accessing ULP program variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html#starting-the-ulp-program">Starting the ULP program</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html#ulp-program-flow">ULP program flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="console.html">Console Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="romconsole.html">ROM debug console</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">External SPI-connected RAM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API Guides</a> &raquo;</li>
        
      <li>ULP coprocessor programming</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api-guides/ulp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ulp-coprocessor-programming">
<h1>ULP coprocessor programming<a class="headerlink" href="ulp.html#ulp-coprocessor-programming" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="ulp_instruction_set.html">Instruction set reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="ulp_macros.html">Programming using macros (legacy)</a></li>
</ul>
</div>
<p>ULP (Ultra Low Power) coprocessor is a simple FSM which is designed to perform measurements using ADC, temperature sensor, and external I2C sensors, while main processors are in deep sleep mode. ULP coprocessor can access RTC_SLOW_MEM memory region, and registers in RTC_CNTL, RTC_IO, and SARADC peripherals. ULP coprocessor uses fixed-width 32-bit instructions, 32-bit memory addressing, and has 4 general purpose 16-bit registers.</p>
<div class="section" id="installing-the-toolchain">
<h2>Installing the toolchain<a class="headerlink" href="ulp.html#installing-the-toolchain" title="Permalink to this headline">¶</a></h2>
<p>ULP coprocessor code is written in assembly and compiled using the <a class="reference external" href="https://github.com/espressif/binutils-esp32ulp">binutils-esp32ulp toolchain</a>.</p>
<p>1. Download the toolchain using the links listed on this page:
<a class="reference external" href="https://github.com/espressif/binutils-esp32ulp/wiki#downloads">https://github.com/espressif/binutils-esp32ulp/wiki#downloads</a></p>
<ol class="arabic simple" start="2">
<li>Extract the toolchain into a directory, and add the path to the <code class="docutils literal"><span class="pre">bin/</span></code> directory of the toolchain to the <code class="docutils literal"><span class="pre">PATH</span></code> environment variable.</li>
</ol>
</div>
<div class="section" id="compiling-ulp-code">
<h2>Compiling ULP code<a class="headerlink" href="ulp.html#compiling-ulp-code" title="Permalink to this headline">¶</a></h2>
<p>To compile ULP code as part of a component, the following steps must be taken:</p>
<ol class="arabic simple">
<li>ULP code, written in assembly, must be added to one or more files with <cite>.S</cite> extension. These files must be placed into a separate directory inside component directory, for instance <cite>ulp/</cite>.</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">Modify the component makefile, adding the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ULP_APP_NAME ?= ulp_$(COMPONENT_NAME)
ULP_S_SOURCES = $(COMPONENT_PATH)/ulp/ulp_source_file.S
ULP_EXP_DEP_OBJECTS := main.o
include $(IDF_PATH)/components/ulp/component_ulp_common.mk
</pre></div>
</div>
<p>Here is each line explained:</p>
<dl class="docutils">
<dt>ULP_APP_NAME</dt>
<dd><p class="first last">Name of the generated ULP application, without an extension. This name is used for build products of the ULP application: ELF file, map file, binary file, generated header file, and generated linker export file.</p>
</dd>
<dt>ULP_S_SOURCES</dt>
<dd><p class="first last">List of assembly files to be passed to the ULP assembler. These must be absolute paths, i.e. start with <code class="docutils literal"><span class="pre">$(COMPONENT_PATH)</span></code>. Consider using <code class="docutils literal"><span class="pre">$(addprefix)</span></code> function if more than one file needs to be listed. Paths are relative to component build directory, so prefixing them is not necessary.</p>
</dd>
<dt>ULP_EXP_DEP_OBJECTS</dt>
<dd><p class="first last">List of object files names within the component which include the generated header file. This list is needed to build the dependencies correctly and ensure that the generated header file is created before any of these files are compiled. See section below explaining the concept of generated header files for ULP applications.</p>
</dd>
<dt>include $(IDF_PATH)/components/ulp/component_ulp_common.mk</dt>
<dd><p class="first last">Includes common definitions of ULP build steps. Defines build targets for ULP object files, ELF file, binary file, etc.</p>
</dd>
</dl>
</li>
<li><p class="first">Build the application as usual (e.g. <cite>make app</cite>)</p>
<p>Inside, the build system will take the following steps to build ULP program:</p>
<ol class="arabic simple">
<li><strong>Run each assembly file (foo.S) through C preprocessor.</strong> This step generates the preprocessed assembly files (foo.ulp.pS) in the component build directory. This step also generates dependency files (foo.ulp.d).</li>
<li><strong>Run preprocessed assembly sources through assembler.</strong> This produces objects (foo.ulp.o) and listing (foo.ulp.lst) files. Listing files are generated for debugging purposes and are not used at later stages of build process.</li>
<li><strong>Run linker script template through C preprocessor.</strong> The template is located in components/ulp/ld directory.</li>
<li><strong>Link object files into an output ELF file</strong> (ulp_app_name.elf). Map file (ulp_app_name.map) generated at this stage may be useful for debugging purposes.</li>
<li><strong>Dump contents of the ELF file into binary</strong> (ulp_app_name.bin) for embedding into the application.</li>
<li><strong>Generate list of global symbols</strong> (ulp_app_name.sym) in the ELF file using esp32ulp-elf-nm.</li>
<li><strong>Create LD export script and header file</strong> (ulp_app_name.ld and ulp_app_name.h) containing the symbols from ulp_app_name.sym. This is done using esp32ulp_mapgen.py utility.</li>
<li><strong>Add the generated binary to the list of binary files</strong> to be emedded into the application.</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="accessing-ulp-program-variables">
<h2>Accessing ULP program variables<a class="headerlink" href="ulp.html#accessing-ulp-program-variables" title="Permalink to this headline">¶</a></h2>
<p>Global symbols defined in the ULP program may be used inside the main program.</p>
<p>For example, ULP program may define a variable <code class="docutils literal"><span class="pre">measurement_count</span></code> which will define the number of ADC measurements the program needs to make before waking up the chip from deep sleep:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                        <span class="o">.</span><span class="k">global</span> <span class="n">measurement_count</span>
<span class="n">measurement_count</span><span class="p">:</span>      <span class="o">.</span><span class="n">long</span> <span class="mi">0</span>

                        <span class="o">/*</span> <span class="n">later</span><span class="p">,</span> <span class="n">use</span> <span class="n">measurement_count</span> <span class="o">*/</span>
                        <span class="n">move</span> <span class="n">r3</span><span class="p">,</span> <span class="n">measurement_count</span>
                        <span class="n">ld</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Main program needs to initialize this variable before ULP program is started. Build system makes this possible by generating a <code class="docutils literal"><span class="pre">$(ULP_APP_NAME).h</span></code> and <code class="docutils literal"><span class="pre">$(ULP_APP_NAME).ld</span></code> files which define global symbols present in the ULP program. This files include each global symbol defined in the ULP program, prefixed with <code class="docutils literal"><span class="pre">ulp_</span></code>.</p>
<p>The header file contains declaration of the symbol:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">uint32_t</span> <span class="n">ulp_measurement_count</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that all symbols (variables, arrays, functions) are declared as <code class="docutils literal"><span class="pre">uint32_t</span></code>. For functions and arrays, take address of the symbol and cast to the appropriate type.</p>
<p>The generated linker script file defines locations of symbols in RTC_SLOW_MEM:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PROVIDE</span> <span class="p">(</span> <span class="n">ulp_measurement_count</span> <span class="o">=</span> <span class="mh">0x50000060</span> <span class="p">);</span>
</pre></div>
</div>
<p>To access ULP program variables from the main program, include the generated header file and use variables as one normally would:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#include &quot;ulp_app_name.h&quot;</span>

<span class="o">//</span> <span class="n">later</span>
<span class="n">void</span> <span class="n">init_ulp_vars</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ulp_measurement_count</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that ULP program can only use lower 16 bits of each 32-bit word in RTC memory, because the registers are 16-bit, and there is no instruction to load from high part of the word.</p>
<p>Likewise, ULP store instruction writes register value into the lower 16 bit part of the 32-bit word. Upper 16 bits are written with a value which depends on the address of the store instruction, so when reading variables written by the ULP, main application needs to mask upper 16 bits, e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Last measurement value: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ulp_last_measurement</span> <span class="o">&amp;</span> <span class="n">UINT16_MAX</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-the-ulp-program">
<h2>Starting the ULP program<a class="headerlink" href="ulp.html#starting-the-ulp-program" title="Permalink to this headline">¶</a></h2>
<p>To run a ULP program, main application needs to load the ULP program into RTC memory using <code class="docutils literal"><span class="pre">ulp_load_binary</span></code> function, and then start it using <code class="docutils literal"><span class="pre">ulp_run</span></code> function.</p>
<p>Note that &#8220;Enable Ultra Low Power (ULP) Coprocessor&#8221; option must be enabled in menuconfig in order to reserve memory for the ULP. &#8220;RTC slow memory reserved for coprocessor&#8221; option must be set to a value sufficient to store ULP code and data. If the application components contain multiple ULP programs, then the size of the RTC memory must be sufficient to hold the largest one.</p>
<p>Each ULP program is embedded into the ESP-IDF application as a binary blob. Application can reference this blob and load it in the following way (suppose ULP_APP_NAME was defined to <code class="docutils literal"><span class="pre">ulp_app_name</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">const</span> <span class="n">uint8_t</span> <span class="n">bin_start</span><span class="p">[]</span> <span class="n">asm</span><span class="p">(</span><span class="s2">&quot;_binary_ulp_app_name_bin_start&quot;</span><span class="p">);</span>
<span class="n">extern</span> <span class="n">const</span> <span class="n">uint8_t</span> <span class="n">bin_end</span><span class="p">[]</span>   <span class="n">asm</span><span class="p">(</span><span class="s2">&quot;_binary_ulp_app_name_bin_end&quot;</span><span class="p">);</span>

<span class="n">void</span> <span class="n">start_ulp_program</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ESP_ERROR_CHECK</span><span class="p">(</span> <span class="n">ulp_load_binary</span><span class="p">(</span>
        <span class="mi">0</span> <span class="o">/*</span> <span class="n">load</span> <span class="n">address</span><span class="p">,</span> <span class="nb">set</span> <span class="n">to</span> <span class="mi">0</span> <span class="n">when</span> <span class="n">using</span> <span class="n">default</span> <span class="n">linker</span> <span class="n">scripts</span> <span class="o">*/</span><span class="p">,</span>
        <span class="n">bin_start</span><span class="p">,</span>
        <span class="p">(</span><span class="n">bin_end</span> <span class="o">-</span> <span class="n">bin_start</span><span class="p">)</span> <span class="o">/</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">uint32_t</span><span class="p">))</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="function">
<dt id="_CPPv215ulp_load_binary8uint32_tPK7uint8_t6size_t">
<span id="ulp_load_binary__uint32_t.uint8_tCP.s"></span><span class="target" id="ulp_8h_1a1ace28e6f59b6e073f7b5d7885bbfe3b"></span>esp_err_t <code class="descclassname"></code><code class="descname">ulp_load_binary</code><span class="sig-paren">(</span>uint32_t <em>load_addr</em>, <em class="property">const</em> uint8_t *<em>program_binary</em>, size_t <em>program_size</em><span class="sig-paren">)</span><a class="headerlink" href="ulp.html#_CPPv215ulp_load_binary8uint32_tPK7uint8_t6size_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Load ULP program binary into RTC memory. </p>
<p>ULP program binary should have the following format (all values little-endian):</p>
<p><ol class="arabic simple">
<li>MAGIC, (value 0x00706c75, 4 bytes)</li>
<li>TEXT_OFFSET, offset of .text section from binary start (2 bytes)</li>
<li>TEXT_SIZE, size of .text section (2 bytes)</li>
<li>DATA_SIZE, size of .data section (2 bytes)</li>
<li>BSS_SIZE, size of .bss section (2 bytes)</li>
<li>(TEXT_OFFSET - 16) bytes of arbitrary data (will not be loaded into RTC memory)</li>
<li>.text section</li>
<li>.data section</li>
</ol>
</p>
<p>Linker script in components/ulp/ld/esp32.ulp.ld produces ELF files which correspond to this format. This linker script produces binaries with load_addr == 0.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd><ul class="simple">
<li>ESP_OK on success</li>
<li>ESP_ERR_INVALID_ARG if load_addr is out of range</li>
<li>ESP_ERR_INVALID_SIZE if program_size doesn&#8217;t match (TEXT_OFFSET + TEXT_SIZE + DATA_SIZE)</li>
<li>ESP_ERR_NOT_SUPPORTED if the magic number is incorrect </li>
</ul>
</dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">load_addr</span></code>: address where the program should be loaded, expressed in 32-bit words </li>
<li><code class="docutils literal"><span class="pre">program_binary</span></code>: pointer to program binary </li>
<li><code class="docutils literal"><span class="pre">program_size</span></code>: size of the program binary </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>Once the program is loaded into RTC memory, application can start it, passing the address of the entry point to <code class="docutils literal"><span class="pre">ulp_run</span></code> function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ESP_ERROR_CHECK</span><span class="p">(</span> <span class="n">ulp_run</span><span class="p">((</span><span class="o">&amp;</span><span class="n">ulp_entry</span> <span class="o">-</span> <span class="n">RTC_SLOW_MEM</span><span class="p">)</span> <span class="o">/</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">uint32_t</span><span class="p">))</span> <span class="p">);</span>
</pre></div>
</div>
<dl class="function">
<dt id="_CPPv27ulp_run8uint32_t">
<span id="ulp_run__uint32_t"></span><span class="target" id="ulp_8h_1a586dfe0767743d066bccd30a1ed517d5"></span>esp_err_t <code class="descclassname"></code><code class="descname">ulp_run</code><span class="sig-paren">(</span>uint32_t <em>entry_point</em><span class="sig-paren">)</span><a class="headerlink" href="ulp.html#_CPPv27ulp_run8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Run the program loaded into RTC memory. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>ESP_OK on success </dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">entry_point</span></code>: entry point, expressed in 32-bit words </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>Declaration of the entry point symbol comes from the above mentioned generated header file, <code class="docutils literal"><span class="pre">$(ULP_APP_NAME).h</span></code>. In assembly source of the ULP application, this symbol must be marked as <code class="docutils literal"><span class="pre">.global</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="o">.</span><span class="k">global</span> <span class="n">entry</span>
<span class="n">entry</span><span class="p">:</span>
        <span class="o">/*</span> <span class="n">code</span> <span class="n">starts</span> <span class="n">here</span> <span class="o">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="ulp-program-flow">
<h2>ULP program flow<a class="headerlink" href="ulp.html#ulp-program-flow" title="Permalink to this headline">¶</a></h2>
<p>ULP coprocessor is started by a timer. The timer is started once <code class="docutils literal"><span class="pre">ulp_run</span></code> is called. The timer counts a number of RTC_SLOW_CLK ticks (by default, produced by an internal 150kHz RC oscillator). The number of ticks is set using <code class="docutils literal"><span class="pre">SENS_ULP_CP_SLEEP_CYCx_REG</span></code> registers (x = 0..4). When starting the ULP for the first time, <code class="docutils literal"><span class="pre">SENS_ULP_CP_SLEEP_CYC0_REG</span></code> will be used to set the number of timer ticks. Later the ULP program can select another <code class="docutils literal"><span class="pre">SENS_ULP_CP_SLEEP_CYCx_REG</span></code> register using <code class="docutils literal"><span class="pre">sleep</span></code> instruction.</p>
<p>The application can set ULP timer period values (SENS_ULP_CP_SLEEP_CYCx_REG, x = 0..4) using <code class="docutils literal"><span class="pre">ulp_wakeup_period_set</span></code> function.</p>
<dl class="function">
<dt id="_CPPv221ulp_set_wakeup_period6size_t8uint32_t">
<span id="ulp_set_wakeup_period__s.uint32_t"></span><span class="target" id="ulp_8h_1a3024599c23b343bb5042da3758317703"></span>esp_err_t <code class="descclassname"></code><code class="descname">ulp_set_wakeup_period</code><span class="sig-paren">(</span>size_t <em>period_index</em>, uint32_t <em>period_us</em><span class="sig-paren">)</span><a class="headerlink" href="ulp.html#_CPPv221ulp_set_wakeup_period6size_t8uint32_t" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Set one of ULP wakeup period values. </p>
<p>ULP coprocessor starts running the program when the wakeup timer counts up to a given value (called period). There are 5 period values which can be programmed into SENS_ULP_CP_SLEEP_CYCx_REG registers, x = 0..4. By default, wakeup timer will use the period set into SENS_ULP_CP_SLEEP_CYC0_REG, i.e. period number 0. ULP program code can use SLEEP instruction to select which of the SENS_ULP_CP_SLEEP_CYCx_REG should be used for subsequent wakeups.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd><ul class="simple">
<li>ESP_OK on success</li>
<li>ESP_ERR_INVALID_ARG if period_index is out of range </li>
</ul>
</dd>
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">period_index</span></code>: wakeup period setting number (0 - 4) </li>
<li><code class="docutils literal"><span class="pre">period_us</span></code>: wakeup period, us </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<p>Once the timer counts the number of ticks set in the selected <code class="docutils literal"><span class="pre">SENS_ULP_CP_SLEEP_CYCx_REG</span></code> register, ULP coprocessor powers up and starts running the program from the entry point set in the call to <code class="docutils literal"><span class="pre">ulp_run</span></code>.</p>
<p>The program runs until it encounters a <code class="docutils literal"><span class="pre">halt</span></code> instruction or an illegal instruction. Once the program halts, ULP coprocessor powers down, and the timer is started again.</p>
<p>To disable the timer (effectively preventing the ULP program from running again), clear the <code class="docutils literal"><span class="pre">RTC_CNTL_ULP_CP_SLP_TIMER_EN</span></code> bit in the <code class="docutils literal"><span class="pre">RTC_CNTL_STATE0_REG</span></code> register. This can be done both from ULP code and from the main program.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ulp_instruction_set.html" class="btn btn-neutral float-right" title="ULP coprocessor instruction set" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../security/secure-boot.html" class="btn btn-neutral" title="Secure Boot" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 - 2017, Espressif.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v3.0-dev-806-gde750e9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>