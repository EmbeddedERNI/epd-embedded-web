
<html>
  <head>
    <meta content="HTML Tidy for HTML5 for Linux version 5.2.0" name="generator"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="FreeRTOS is a portable, open source, mini Real Time kernel. A free RTOS for small embedded systems" name="description"/>
    <meta content="MPU, MMU, Memory Management Unit, Memory Protection Unit, 8051, 8052, Free RTOS, royalty free, RTOS, free, RTOS free, open source, real time, embedded, FreeRTOS, source code, AVR, GNU, PIC, PIC18, development tools" name="keywords"/>
    <title>FreeRTOS-MPU, a FreeRTOS with memory protection support</title>

    <link href="doxygen.css" rel="stylesheet"/>
    <style type="text/css">
</style>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <script src="banners.js" type="text/javascript">
</script>
    <script src="stlib.js" type="text/javascript">
</script>
    <script src="left_menu.js" type="text/javascript">
</script>
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript">
</script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js">
</script>
    <link href="code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
    <script type="text/javascript">
        window.onload = function()
        {
                var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

                if( rect1.right >= window.innerWidth )
                {
                        document.getElementById( 'td_right_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_right_side_bar' ).style.width = '0';
                }
        };
</script>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6086815-2']);
  _gaq.push(['_setDomainName', 'freertos.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
    <script type="text/javascript">
        function check_left_image_clash()
        {
                var rect1 = document.getElementById( 'left_banner_image' ).getBoundingClientRect();
                var rect2 = document.getElementById( 'id_tree_menu' ).getBoundingClientRect();

                if ( rect1.right >= rect2.left ) {
                        document.getElementById( 'td_left_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_left_side_bar' ).style.width = '0';
                }
        }
</script>
    <script type="text/javascript">
        function check_right_image_clash()
        {
                var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

                if( rect1.right >= window.innerWidth )
                {
                        document.getElementById( 'td_right_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_right_side_bar' ).style.width = '0';
                }
        }
</script>
    <script type="text/javascript">
        $( document ).ready( function()
                                                {
                                                        window.setTimeout("blindDownMenuHint();", 5000);
                                                        window.setTimeout("blindUpMenuHint();", 12000);
                                                }
        )

        function blindDownMenuHint()
        {
                if( window.name != "done" )
                {
                        $( "#menu_hint").show( "blind", "slow" );
                        window.name = "done";
                }
        }

        function blindUpMenuHint()
        {
                $( "#menu_hint").hide( "blind", "slow" );
        }

</script></head>

  <body><font face="Arial"><a id="page_top" name="page_top"/></font>
    <table>
      <tbody>
        <tr>
          <td valign="top">
            <!-- Content area - the other td is the side bar area. -->
            <table align="center" cellpadding="5" cellspacing="0" style="height:100%;background:white; border-left:solid 1px #f0f0f0; border-right:solid 1px #f0f0f0;">
              <tbody>
                <tr valign="top">
                  <td colspan="3" style="height:100px;">
                    <!-- Spans the left menu, blank line, and main content columns of the next row. -->

                    <table border="0" cellpadding="0" cellspacing="2" style="width:100%;"><!-- Rows for logos and banners, blue lines with menu. -->

                      <tbody>
                        <tr style="padding: 0px 0px 0px 0px;"><!-- Top row, banner and logo. -->

                          <td>
                            <table cellpadding="0" cellspacing="5px" style="table-layout:fixed;" width="100%">
                              <tbody>
                                <tr>
                                  <td id="logo_column" style="line-height:normal;" valign="middle" width="174px">
                                    <div style="float:left;"><a href="index.html"><img alt="Free RTOS logo" border="0" src="logo.jpg" style="padding: 0 0 0 5px;" width="164px"/></a></div>
                                  </td>

                                  <td style="width:5px; border-top:solid 2px #e6e6e6; border-left:solid 2px #e6e6e6; border-bottom:solid 2px #e6e6e6;"> &nbsp;</td>

                                  <td id="page_heading_largerx" style="line-height:normal; width:324px;" valign="middle">
                                    <h3>Quality RTOS &amp; Embedded
                                      Software<br/>
                                    </h3>

                                    
                                  </td>

                                  <td>
                                    
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>

                        <tr bgcolor="#7095D3" style="height:5px;"><!-- Blank line. -->

                          <td/>
                        </tr>

                        <tr bgcolor="#B6CFFE" style="height:19px;"><!-- Horizontal menu. -->

                          <td bgcolor="#B6CFFE" valign="middle">
                            <!-- Top menu with social media icons. -->
                            

                            

                            

                            <table cellpadding="0" cellspacing="0" style="padding-top:4px;"><!-- Top horizontal menu. -->

                              <tbody>
                                <tr>
                                  <td width="4px">
                                    <!-- Just brings the first white menu spacing bar in from the left of the blue bar. --></td>

                                  <td align="center" style="border-right:solid 2px white; border-left:solid 2px white; width:100px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:112px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:104px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:94px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:94px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:90px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:90px; line-height:normal;"/>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>

                <tr valign="top"><!-- Main content row with menu and content area columns. -->

                  

                  <td style="width:2px; padding-right:0; padding-left:0;"> <!-- Blank column. -->
                    <!-- Just to move the main text away from the silver verticle line slightly. --></td>

                  <td id="td_main_content_column"><!-- Main content area. -->
                    <table border="0" cellpadding="0" cellspacing="0" id="menu_hint" style="height:30px; background:#ffff99; display:none;">
                      <tbody>
                        <tr valign="middle">
                          <td width="5px"/>

                          <td width="30px"><img border="0" height="25px" src="menu_hint_arrow.png" style="padding:0;"/></td>

                          <td valign="middle">Hint: Use the tree menu
                            to navigate groups of related pages &nbsp;</td>
                        </tr>
                      </tbody>
                    </table>

                    <h1>xTaskCreateRestricted<br/>
                      <small>[<a class="el" href="FreeRTOS-MPU-specific.html">FreeRTOS-MPU
                      Specific</a>]</small></h1>
                    task. h
                    <pre><font face="courier">
BaseType_t xTaskCreateRestricted(
                            TaskParameters_t *pxTaskDefinition,
                            TaskHandle_t *pxCreatedTask );</font></pre>

                    <p>Create a new Memory Protection Unit (MPU)
                      restricted task and add it to the list of tasks
                      that are ready to run.</p>

                    <p>xTaskCreateRestricted() is intended for use
                      with <a href="FreeRTOS-MPU-memory-protection-unit.html">FreeRTOS-MPU</a>, the <a href="FreeRTOS-MPU-memory-protection-unit.html#FreeRTOS-MPU-Demos">demo applications</a> for which contain
                      comprehensive and documented examples of
                      xTaskCreateRestricted() being used.</p>

                    <dl compact="compact">
                      <dt><b>Parameters:</b></dt>

                      <dd>
                        <table border="0" cellpadding="0" cellspacing="10">
                          <tbody>
                            <tr>
                              <td valign="top"><em>pxTaskDefinition</em>&nbsp;</td>

                              <td><font face="arial">Pointer to a
                                structure that defines the task. The
                                structure is described on this
                                page.</font></td>
                            </tr>

                            <tr>
                              <td valign="top"><em>pxCreatedTask</em>&nbsp;</td>

                              <td><font face="arial">Used to pass
                                back a handle by which the created task
                                can be referenced.</font></td>
                            </tr>
                          </tbody>
                        </table>
                      </dd>
                    </dl>

                    <dl compact="compact">
                      <dt><b>Returns:</b></dt>

                      <dd>pdPASS if the task was successfully created
                        and added to a ready list, otherwise an error
                        code defined in the file projdefs.h</dd>
                    </dl>

                    <p>Tasks that include MPU support require even
                      more parameters to create than those that don't.
                      Passing each parameter to xTaskCreateRestricted()
                      individually would be unwieldy so instead the
                      structure TaskParameters_t is used to allow the
                      parameters to be configured statically at compile
                      time. The structure is defined in task.h as:</p>

                    <p><br/>
                    </p>

                    <hr width="50%"/>

                    <pre>
typedef struct xTASK_PARAMETERS
{
    TaskFunction_t pvTaskCode;
    const signed char * const pcName;
    unsigned short usStackDepth;
    void *pvParameters;
    UBaseType_t uxPriority;
    portSTACK_TYPE *puxStackBuffer;
    MemoryRegion_t xRegions[ portNUM_CONFIGURABLE_REGIONS ];
} TaskParameters_t;

....<font face="arial">where MemoryRegion_t is defined as:</font>

typedef struct xMEMORY_REGION
{
    void *pvBaseAddress;
    unsigned long ulLengthInBytes;
    unsigned long ulParameters;
} MemoryRegion_t;
</pre>

                    <hr width="50%"/>

                    <p><br/>
                      Following is a description of each structure
                      member:</p>

                    <ul>
                      <li>pvTaskCode to uxPriority
                        <p>These members are exactly the same as the
                          parameters to <a href="a00125.html">xTaskCreate()</a> of the same name. In
                          particular uxPriority is used to set both the
                          priority of the task and the mode in which
                          the task will execute. For example, to create
                          a User mode task at priority 2 simply set
                          uxPriority to 2, to create a Privileged mode
                          task at priority 2 set uxPriority to ( 2 |
                          portPRIVILEGE_BIT ).</p>
                      </li>

                      <li>puxStackBuffer
                        <p>Each time a task is switched in the MPU is
                          dynamically re-configured to define a region
                          that provides the task read and write access
                          to its own stack. MPU regions must meet a
                          number of constraints - in particular, the
                          size and alignment of each region must both
                          be equal to the same power of two value.</p>

                        <p>Standard FreeRTOS ports use pvPortMalloc()
                          to allocate a new stacks each time a task is
                          created. Providing a pvPortMalloc()
                          implementation that took care of the MPU data
                          alignment requirements would be possible but
                          would also be complex and inefficient in its
                          RAM usage. To remove the need for this
                          complexity FreeRTOS-MPU allows stacks to be
                          declared statically at compile time. This
                          allows the alignment to be managed using
                          compiler extensions and RAM usage efficiency
                          to be managed by the linker. For example, if
                          using GCC a stack could be declared and
                          correctly aligned using the following code:</p>

                        <pre>
    char cTaskStack[ 1024 ] __attribute__((align(1024));
        </pre>
                        puxStackBuffer would normally be set to the
                        address of the statically declared stack. As an
                        alternative puxStackBuffer can be set to NULL -
                        in which case pvPortMallocAligned() will be
                        called to allocate the task stack and it is the
                        application writers responsibility to provide
                        an implementation of pvPortMallocAligned() that
                        meets the alignment requirements of the MPU.</li>

                      <li>xMemoryRegions
                        <p>xRegions is an array of MemoryRegion_t
                          structures, each of which defines a single
                          user definable memory region for use by the
                          task being created. The ARM Cortex-M3
                          FreeRTOS-MPU port defines
                          portNUM_CONFIGURABLE_REGIONS to be 3.</p>

                        <p>The pvBaseAddress and ulLengthInBytes
                          members are self explanatory as the start of
                          the memory region and the length of the
                          memory region respectively. ulParameters
                          defines how the task is permitted to access
                          the memory region and can take the bitwise OR
                          of the following values:</p>

                        <pre>
    portMPU_REGION_READ_WRITE
    portMPU_REGION_PRIVILEGED_READ_ONLY
    portMPU_REGION_READ_ONLY
    portMPU_REGION_PRIVILEGED_READ_WRITE
    portMPU_REGION_CACHEABLE_BUFFERABLE
    portMPU_REGION_EXECUTE_NEVER
        </pre>
                      </li>
                    </ul>

                    <p>Example usage (please refer to the FreeRTOS-MPU
                      <a href="FreeRTOS-MPU-memory-protection-unit.html#FreeRTOS-MPU-Demos">demo applications</a> for a much more complete
                      and comprehensive example):</p>

                    <div><font color="green">/* Declare the stack
                      that will be used by the task. The stack
                      alignment must match its size and be a power of
                      2, so if 128 words are reserved for the stack
                      then it must be aligned to ( 128 * 4 ) bytes.
                      This example used GCC syntax. */</font> static
                      portSTACK_TYPE xTaskStack[ 128 ]
                      __attribute__((aligned(128*4))); <font color="green">/* Declare an array that will be
                      accessed by the task. The task should only be
                      able to read from the array, and not write to it.
                      */</font> char cReadOnlyArray[ 512 ]
                      __attribute__((aligned(512))); <font color="green">/* Fill in a TaskParameters_t
                      structure to define the task - this is the
                      structure passed to the xTaskCreateRestricted()
                      function. */</font> static const
                      TaskParameters_t xTaskDefinition = {
                      vTaskFunction, <font color="green">/* pvTaskCode
                      */</font> "A task", <font color="green">/*
                      pcName */</font> 128, <font color="green">/*
                      usStackDepth - defined in words, not bytes.
                      */</font> NULL, <font color="green">/*
                      pvParameters */</font> 1, <font color="green">/* uxPriority - priority 1, start in User mode.
                      */</font> xTaskStack, <font color="green">/*
                      puxStackBuffer - the array to use as the task
                      stack. */</font> <font color="green">/*
                      xRegions - In this case only one of the three
                      user definable regions is actually used. The
                      parameters are used to set the region to read
                      only. */</font> { <font color="green">/* Base
                      address Length Parameters */</font> {
                      cReadOnlyArray, mainREAD_ONLY_ALIGN_SIZE,
                      portMPU_REGION_READ_ONLY }, { 0, 0, 0 }, { 0, 0,
                      0 }, } }; void main( void ) { <font color="green">/* Create the task defined by xTaskDefinition.
                      NULL is used as the second parameter as a task
                      handle is not required. */</font>
                      xTaskCreateRestricted( &amp;xTaskDefinition, NULL
                      ); <font color="green">/* Start the RTOS
                      scheduler. */</font> vTaskStartScheduler();
                      <font color="green">/* Should not reach here!
                      */</font> }</div>

                    <pre> <br/><br/><br/><br/><br/>

                                                <br/>
                                                <br/>                                                </pre>

                    <div align="center"><a href="#page_top"><small>[
                      Back to the top ]</small></a> &nbsp;&nbsp; <a href="RTOS.html"><small>[ About FreeRTOS
                      ]</small></a> &nbsp;&nbsp; <a href="static_menu.html"><small>[ Sitemap
                      ]</small></a> &nbsp;&nbsp; <small>[
                      <script type="text/javascript">
<!--
                                                        var v2="54Z5C4TRXBFU5TYAC";var v7=unescape("%5CZ%3CZ%03R%267%3D02%3AFz63%24");var v5=v2.length;var v1="";for(var v4=0;v4<v5;v4++){v1+=String.fromCharCode(v2.charCodeAt(v4)^v7.charCodeAt(v4));}document.write('<a href="javascript:void(0)" onclick="window.location=\'mail\u0074o\u003a'+v1+'?subject=Website%20feedback'+'\'">'+'Report an error on this page<\/a>');
                                                        //-->
</script></small>
                      <noscript/>
                      <a href="http://w2.syronex.com/jmr/safemailto/#noscript">Report an error on this page (with anti-spam)</a> ]</div>

                    <pre>
                                                <br/>                                                <br/>
                                                <br/>                                                <br/>
                                                <br/>                                                <br/>
                                                <br/>                                                </pre>

                    <div align="center" class="text_ad"><font size="1">Copyright (C) 2004-2010 Richard Barry. Copyright
                      (C) 2010-2016 Real Time Engineers Ltd.<br/>
                      Any and all data, files, source code, html
                      content and documentation included in the
                      FreeRTOS<small><sup>TM</sup></small>
                      distribution or available on this site are the
                      exclusive property of Real Time Engineers Ltd..
                      See the files license.txt (included in the
                      distribution) and this <a href="copyright.html">copyright notice</a> for more information.
                      FreeRTOS<sup>TM</sup> and FreeRTOS.org<sup>TM</sup> are trade marks of Real Time Engineers
                      Ltd.</font></div>

                    <pre>
                                        </pre>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>

          
        </tr>
      </tbody>
    </table>

    <script language="JavaScript" type="text/javascript">
<!--
        document.getElementById('banner_div').innerHTML = show_banners2();
//-->
</script></body>
</html>
