
<html>
  <head>
    <meta content="HTML Tidy for HTML5 for Linux version 5.2.0" name="generator"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="Create a set of RTOS queue and semaphore objects to allow an RTOS task to pend (or block) on multiple queues at the same time" name="description"/>
    <meta content="RTOS, block, pend, multiple, queue, semaphore, mutex" name="keywords"/>
    <title>Pend (or block) on multiple RTOS queues and semaphores in a
      set</title>

    <link href="doxygen.css" rel="stylesheet"/>
    <style type="text/css">
</style>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <script src="banners.js" type="text/javascript">
</script>
    <script src="stlib.js" type="text/javascript">
</script>
    <script src="left_menu.js" type="text/javascript">
</script>
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript">
</script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js">
</script>
    <link href="code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
    <script type="text/javascript">
        window.onload = function()
        {
                var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

                if( rect1.right >= window.innerWidth )
                {
                        document.getElementById( 'td_right_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_right_side_bar' ).style.width = '0';
                }
        };
</script>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6086815-2']);
  _gaq.push(['_setDomainName', 'freertos.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
    <script type="text/javascript">
        function check_left_image_clash()
        {
                var rect1 = document.getElementById( 'left_banner_image' ).getBoundingClientRect();
                var rect2 = document.getElementById( 'id_tree_menu' ).getBoundingClientRect();

                if ( rect1.right >= rect2.left ) {
                        document.getElementById( 'td_left_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_left_side_bar' ).style.width = '0';
                }
        }
</script>
    <script type="text/javascript">
        function check_right_image_clash()
        {
                var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

                if( rect1.right >= window.innerWidth )
                {
                        document.getElementById( 'td_right_side_bar' ).style.display = 'none';
                        document.getElementById( 'td_right_side_bar' ).style.width = '0';
                }
        }
</script>
    <script type="text/javascript">
        $( document ).ready( function()
                                                {
                                                        window.setTimeout("blindDownMenuHint();", 5000);
                                                        window.setTimeout("blindUpMenuHint();", 12000);
                                                }
        )

        function blindDownMenuHint()
        {
                if( window.name != "done" )
                {
                        $( "#menu_hint").show( "blind", "slow" );
                        window.name = "done";
                }
        }

        function blindUpMenuHint()
        {
                $( "#menu_hint").hide( "blind", "slow" );
        }

</script></head>

  <body><font face="Arial"><a id="page_top" name="page_top"/></font>
    <table>
      <tbody>
        <tr>
          <td valign="top">
            <!-- Content area - the other td is the side bar area. -->
            <table align="center" cellpadding="5" cellspacing="0" style="height:100%;background:white; border-left:solid 1px #f0f0f0; border-right:solid 1px #f0f0f0;">
              <tbody>
                <tr valign="top">
                  <td colspan="3" style="height:100px;">
                    <!-- Spans the left menu, blank line, and main content columns of the next row. -->

                    <table border="0" cellpadding="0" cellspacing="2" style="width:100%;"><!-- Rows for logos and banners, blue lines with menu. -->

                      <tbody>
                        <tr style="padding: 0px 0px 0px 0px;"><!-- Top row, banner and logo. -->

                          <td>
                            <table cellpadding="0" cellspacing="5px" style="table-layout:fixed;" width="100%">
                              <tbody>
                                <tr>
                                  <td id="logo_column" style="line-height:normal;" valign="middle" width="174px">
                                    <div style="float:left;"><a href="index.html"><img alt="Free RTOS logo" border="0" src="logo.jpg" style="padding: 0 0 0 5px;" width="164px"/></a></div>
                                  </td>

                                  <td style="width:5px; border-top:solid 2px #e6e6e6; border-left:solid 2px #e6e6e6; border-bottom:solid 2px #e6e6e6;"> &nbsp;</td>

                                  <td id="page_heading_largerx" style="line-height:normal; width:324px;" valign="middle">
                                    <h3>Quality RTOS &amp; Embedded
                                      Software<br/>
                                    </h3>

                                    
                                  </td>

                                  <td>
                                    
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>

                        <tr bgcolor="#7095D3" style="height:5px;"><!-- Blank line. -->

                          <td/>
                        </tr>

                        <tr bgcolor="#B6CFFE" style="height:19px;"><!-- Horizontal menu. -->

                          <td bgcolor="#B6CFFE" valign="middle">
                            <!-- Top menu with social media icons. -->
                            

                            

                            

                            <table cellpadding="0" cellspacing="0" style="padding-top:4px;"><!-- Top horizontal menu. -->

                              <tbody>
                                <tr>
                                  <td width="4px">
                                    <!-- Just brings the first white menu spacing bar in from the left of the blue bar. --></td>

                                  <td align="center" style="border-right:solid 2px white; border-left:solid 2px white; width:100px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:112px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:104px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:94px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:94px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:90px; line-height:normal;"/>

                                  <td align="center" style="border-right:solid 2px white; width:90px; line-height:normal;"/>
                                </tr>
                              </tbody>
                            </table>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>

                <tr valign="top"><!-- Main content row with menu and content area columns. -->

                  

                  <td style="width:2px; padding-right:0; padding-left:0;"> <!-- Blank column. -->
                    <!-- Just to move the main text away from the silver verticle line slightly. --></td>

                  <td id="td_main_content_column"><!-- Main content area. -->
                    <table border="0" cellpadding="0" cellspacing="0" id="menu_hint" style="height:30px; background:#ffff99; display:none;">
                      <tbody>
                        <tr valign="middle">
                          <td width="5px"/>

                          <td width="30px"><img border="0" height="25px" src="menu_hint_arrow.png" style="padding:0;"/></td>

                          <td valign="middle">Hint: Use the tree menu
                            to navigate groups of related pages &nbsp;</td>
                        </tr>
                      </tbody>
                    </table>

                    <h1>xQueueCreateSet()<br/>
                      <small>[<a class="el" href="RTOS-queue-sets.html">Queue Set API</a>]</small></h1>
                    queue.h
                    <pre><font face="courier">
 QueueSetHandle_t xQueueCreateSet
               (
                   const UBaseType_t uxEventQueueLength
               );
</font></pre>

                    <p>configUSE_QUEUE_SETS must be set to 1 in
                      FreeRTOSConfig.h for the xQueueCreateSet() API
                      function to be available.</p>

                    <p>Queue sets provide a mechanism to allow an RTOS
                      task to block (pend) on a read operation from
                      multiple RTOS queues or semaphores
                      simultaneously. Note that there are simpler
                      alternatives to using queue sets. See the <a href="Pend-on-multiple-rtos-objects.html">Blocking on Multiple Objects</a> page for more
                      information.</p>

                    <p>A queue set must be explicitly created using a
                      call to xQueueCreateSet() before it can be used.
                      Once created, standard FreeRTOS queues and
                      semaphores can be added to the set using calls to
                      <a href="xQueueAddToSet.html">xQueueAddToSet()</a>. <a href="xQueueSelectFromSet.html">xQueueSelectFromSet()</a> is then used to
                      determine which, if any, of the queues or
                      semaphores contained in the set is in a state
                      where a queue read or semaphore take operation
                      would be successful.</p>

                    <p>Notes:</p>

                    <ul>
                      <li>Queues and semaphores <b>must be empty</b>
                        when they are added to a queue set. Take
                        particular care when adding objects such as
                        binary semaphores which are created with the
                        semaphore already available [this is the case
                        if the semaphore is created using the
                        vSemaphoreCreateBinary() macro, but not the
                        case if the semaphore is created using the
                        preferred xSemaphoreCreateBinary() function].</li>

                      <li>Blocking on a queue set that contains a
                        mutex will not cause the mutex holder to
                        inherit the priority of the blocked task.</li>

                      <li>An additional 4 bytes of RAM are required
                        for each space in every queue added to a queue
                        set. Therefore a counting semaphore that has a
                        high maximum count value should not be added to
                        a queue set.</li>

                      <li>A receive (in the case of a queue) or take
                        (in the case of a semaphore) operation must not
                        be performed on a member of a queue set unless
                        a call to xQueueSelectFromSet() has first
                        returned a handle to that set member.</li>
                    </ul>

                    <dl compact="compact">
                      <dt><b>Parameters:</b></dt>

                      <dd>
                        <table border="0" cellpadding="0" cellspacing="10">
                          <tbody>
                            <tr>
                              <td valign="top"><font face="arial"><em>uxEventQueueLength</em></font>
                                &nbsp;</td>

                              <td><font face="arial">Queue sets store
                                events that occur on the queues and
                                semaphores contained in the set.
                                uxEventQueueLength specifies the
                                maximum number of events that can be
                                queued at once.</font>
                                <p><font face="arial">To be
                                  absolutely certain that events are
                                  not lost uxEventQueueLength must be
                                  set to the sum of the lengths of the
                                  queues added to the set, where binary
                                  semaphores and mutexes have a length
                                  of 1, and counting semaphores have a
                                  length set by their maximum count
                                  value. For example:</font></p>

                                <ul>
                                  <li><font face="arial">If a queue
                                    set is to hold a queue of length 5,
                                    another queue of length 12, and a
                                    binary semaphore, then
                                    uxEventQueueLength should be set to
                                    (5 + 12 + 1), or 18.</font></li>

                                  <li><font face="arial">If a queue
                                    set is to hold three binary
                                    semaphores then uxEventQueueLength
                                    should be set to (1 + 1 + 1 ), or
                                    3.</font></li>

                                  <li><font face="arial">If a queue
                                    set is to hold a counting semaphore
                                    that has a maximum count of 5, and
                                    a counting semaphore that has a
                                    maximum count of 3, then
                                    uxEventQueueLength should be set to
                                    (5 + 3), or 8.</font></li>
                                </ul>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </dd>
                    </dl>

                    <dl compact="compact">
                      <dt><b>Returns:</b></dt>

                      <dd>If the queue set is created successfully
                        then a handle to the created queue set is
                        returned. Otherwise NULL is returned.</dd>
                    </dl>
                    <b>Example usage:</b>
                    <pre><font face="courier">
<font color="green">/* Define the lengths of the queues that will be added to the queue set. */</font>
#define QUEUE_LENGTH_1          10
#define QUEUE_LENGTH_2          10

<font color="green">/* Binary semaphores have an effective length of 1. */</font>
#define BINARY_SEMAPHORE_LENGTH 1

<font color="green">/* Define the size of the item to be held by queue 1 and queue 2 respectively.
The values used here are just for demonstration purposes. */</font>
#define ITEM_SIZE_QUEUE_1       sizeof( uint32_t )
#define ITEM_SIZE_QUEUE_2       sizeof( something_else_t )

<font color="green">/* The combined length of the two queues and binary semaphore that will be
added to the queue set. */</font>
#define COMBINED_LENGTH ( QUEUE_LENGTH_1 +
                          QUEUE_LENGTH_2 +
                          BINARY_SEMAPHORE_LENGTH )

void vAFunction( void )
{
static QueueSetHandle_t xQueueSet;
QueueHandle_t xQueue1, xQueue2, xSemaphore;
QueueSetMemberHandle_t xActivatedMember;
uint32_t xReceivedFromQueue1;
something_else_t xReceivedFromQueue2;

    <font color="green">/* Create the queue set large enough to hold an event for every space in
    every queue and semaphore that is to be added to the set. */</font>
    xQueueSet = xQueueCreateSet( COMBINED_LENGTH );

    <font color="green">/* Create the queues and semaphores that will be contained in the set. */</font>
    xQueue1 = xQueueCreate( QUEUE_LENGTH_1, ITEM_SIZE_QUEUE_1 );
    xQueue2 = xQueueCreate( QUEUE_LENGTH_2, ITEM_SIZE_QUEUE_2 );

    <font color="green">/* Create the semaphore that is being added to the set. */</font>
    xSemaphore = xSemaphoreCreateBinary();

    <font color="green">/* Check everything was created. */</font>
    configASSERT( xQueueSet );
    configASSERT( xQueue1 );
    configASSERT( xQueue2 );
    configASSERT( xSemaphore );

    <font color="green">/* Add the queues and semaphores to the set.  Reading from these queues and
    semaphore can only be performed after a call to xQueueSelectFromSet() has
    returned the queue or semaphore handle from this point on. */</font>
    xQueueAddToSet( xQueue1, xQueueSet );
    xQueueAddToSet( xQueue2, xQueueSet );
    xQueueAddToSet( xSemaphore, xQueueSet );

    for( ;; )
    {
        <font color="green">/* Block to wait for something to be available from the queues or
        semaphore that have been added to the set.  Don't block longer than
        200ms. */</font>
        xActivatedMember = xQueueSelectFromSet( xQueueSet,
                                                200 / portTICK_PERIOD_MS );

        <font color="green">/* Which set member was selected?  Receives/takes can use a block time
        of zero as they are guaranteed to pass because xQueueSelectFromSet()
        would not have returned the handle unless something was available. */</font>
        if( xActivatedMember == xQueue1 )
        {
            xQueueReceive( xActivatedMember, &amp;xReceivedFromQueue1, 0 );
            vProcessValueFromQueue1( xReceivedFromQueue1 );
        }
        else if( xActivatedMember == xQueue2 )
        {
            xQueueReceive( xActivatedMember, &amp;xReceivedFromQueue2, 0 );
            vProcessValueFromQueue2( &amp;xReceivedFromQueue2 );
        }
        else if( xActivatedMember == xSemaphore )
        {
            <font color="green">/* Take the semaphore to make sure it can be "given" again. */</font>
            xSemaphoreTake( xActivatedMember, 0 );
            vProcessEventNotifiedBySemaphore();
            break;
        }
        else
        {
            <font color="green">/* The 200ms block time expired without an RTOS queue or semaphore
            being ready to process. */</font>
        }
    }
}
</font></pre>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                    <br/>

                    <p><br/>
                    </p>

                    <div align="center"><a href="#page_top"><small>[
                      Back to the top ]</small></a> &nbsp;&nbsp; <a href="RTOS.html"><small>[ About FreeRTOS
                      ]</small></a> &nbsp;&nbsp; <a href="index.html"><small>[ Sitemap
                      ]</small></a> &nbsp;&nbsp; <small>[
                      <script type="text/javascript">
<!--
                                                        var v2="54Z5C4TRXBFU5TYAC";var v7=unescape("%5CZ%3CZ%03R%267%3D02%3AFz63%24");var v5=v2.length;var v1="";for(var v4=0;v4<v5;v4++){v1+=String.fromCharCode(v2.charCodeAt(v4)^v7.charCodeAt(v4));}document.write('<a href="javascript:void(0)" onclick="window.location=\'mail\u0074o\u003a'+v1+'?subject=Website%20feedback'+'\'">'+'Report an error on this page<\/a>');
                                                        //-->
</script></small>
                      <noscript/>
                      <a href="http://w2.syronex.com/jmr/safemailto/#noscript">Report an error on this page (with anti-spam)</a> ]</div>
                    <br/>

                    <p><br/>
                    </p>

                    <p><br/>
                    </p>

                    <p><br/>
                    </p>

                    <div align="center" class="text_ad"><font size="1">Copyright (C) 2004-2010 Richard Barry. Copyright
                      (C) 2010-2016 Real Time Engineers Ltd.<br/>
                      Any and all data, files, source code, html
                      content and documentation included in the
                      FreeRTOS<small><sup>TM</sup></small>
                      distribution or available on this site are the
                      exclusive property of Real Time Engineers Ltd..
                      See the files license.txt (included in the
                      distribution) and this <a href="copyright.html">copyright notice</a> for more information.
                      FreeRTOS<sup>TM</sup> and FreeRTOS.org<sup>TM</sup> are trade marks of Real Time Engineers
                      Ltd.</font></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>

          
        </tr>
      </tbody>
    </table>

    <script language="JavaScript" type="text/javascript">
<!--
        document.getElementById('banner_div').innerHTML = show_banners2();
//-->
</script></body>
</html>
