<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<META name="description" content="FreeRTOS is a portable, open source, mini Real Time kernel.  A free RTOS for small embedded systems">
<META name="keywords" content="ColdFire, V2, MCF5282, MCF5282EVB, PIC32, MIPS, M4K, PIC24, dsPIC, ARM Cortex-M3, Cortex, Free RTOS, royalty free, RTOS, source code, AVR, GNU, PIC, PIC18, development tools">
<title>FreeRTOS simulator for Posix/Linux</title>
<link rel="stylesheet" href="doxygen.css"><style type="text/css"></style>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="http://www.freertos.org/banners.js"></script>
<script type="text/javascript" src="http://www.freertos.org/stlib.js"></script>
<script type="text/javascript" src="http://www.freertos.org/left_menu.js"></script>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">

<script type="text/javascript">
	window.onload = function()
	{
		var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

		if( rect1.right >= window.innerWidth )
		{
			document.getElementById( 'td_right_side_bar' ).style.display = 'none';
			document.getElementById( 'td_right_side_bar' ).style.width = '0';
		}
	};
</script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-6086815-2']);
  _gaq.push(['_setDomainName', 'freertos.org']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
	function check_left_image_clash()
	{
		var rect1 = document.getElementById( 'left_banner_image' ).getBoundingClientRect();
		var rect2 = document.getElementById( 'id_tree_menu' ).getBoundingClientRect();

		if ( rect1.right >= rect2.left ) {
			document.getElementById( 'td_left_side_bar' ).style.display = 'none';
			document.getElementById( 'td_left_side_bar' ).style.width = '0';
		}
	}
</script>

<script type="text/javascript">
	function check_right_image_clash()
	{
		var rect1 = document.getElementById( 'td_right_side_bar' ).getBoundingClientRect();

		if( rect1.right >= window.innerWidth )
		{
			document.getElementById( 'td_right_side_bar' ).style.display = 'none';
			document.getElementById( 'td_right_side_bar' ).style.width = '0';
		}
	}
</script>


<script type="text/javascript">
	$( document ).ready( function()
						{
							window.setTimeout("blindDownMenuHint();", 5000);
							window.setTimeout("blindUpMenuHint();", 12000);
						}
	)

	function blindDownMenuHint()
	{
		if( window.name != "done" )
		{
			$( "#menu_hint").show( "blind", "slow" );
			window.name = "done";
		}
	}

	function blindUpMenuHint()
	{
		$( "#menu_hint").hide( "blind", "slow" );
	}

</script>


</head>



<body>
<font face="Arial">

<a name="page_top"></a>

<table>
	<tr>
		<td valign="top">
			<!-- Content area - the other td is the side bar area. -->
			<table style="height:100%;background:white; border-left:solid 1px #f0f0f0; border-right:solid 1px #f0f0f0;" cellpadding="5" cellspacing="0" align="center">
				<tr valign="top">
					<td colspan="3" style="height:100px;"> <!-- Spans the left menu, blank line, and main content columns of the next row. -->
						<font face="Arial, Helvetica">
							<table style="width:100%;" cellspacing="2" cellpadding="0" border="0"> <!-- Rows for logos and banners, blue lines with menu. -->

								<tr  style="padding: 0px 0px 0px 0px;"> <!-- Top row, banner and logo. -->
									<td>
										<table width="100%" cellpadding="0" cellspacing="5px" style="table-layout:fixed;">
											<tr>
												<td style="line-height:normal;" valign="middle" width="174px" id="logo_column">
													<div style="float:left;">
														<a href="http://www.freertos.org/index.html">
															<img src="logo.jpg" alt="Free RTOS logo" width="164px" border="0" style="padding: 0 0 0 5px;">
														</a>
													</div>
												</td>
												<td style="width:5px; border-top:solid 2px #e6e6e6; border-left:solid 2px #e6e6e6; border-bottom:solid 2px #e6e6e6;">
													&nbsp;
												</td>
												<td valign="middle" style="line-height:normal; width:324px;" id="page_heading_largerx">
													<h3>
														Quality RTOS &amp; Embedded Software
														<br>
														<small>
															<small>
																<div id="logo_links">
																	<a href="RTOS.html"><u>About</u></a>
																	<font size="1">&nbsp;</font>
																	<a href="RTOS-contact-and-support.html"><u>Contact</u></a></u>
																	<font size="1">&nbsp;</font>
																	<a href="freertos_support_forum_archive_index.html"><u>Support</u></a></u>
																	<font size="1">&nbsp;</font>
																	<a href="FAQ.html"><u>FAQ</u></a></u>
																	<font size="1">&nbsp;</font>
																	<a href="a00104.html"><u>Download</u></a></u>
																</div>
																<div id="logo_sitemap_link">
																	<a href="static_menu.html"><u>Static Menu</u></a>
																	<font size="1">&nbsp;</font>
																</div>
															</small>
														</small>
													</h3>
												</td>
												<td>
													<div id="banner_div" style="float:right; padding: 0px 0px 3px 0px; max-width:100%;"> <!-- Pad the bottom of the image slightly to keep it away from blue bar. -->
														<a href="RTOS-contact-and-support.html">Advertise here?</a>
													</div>
												</td>
											</tr>
										</table>
									</td>
								</tr>
								<tr style="height:5px;" bgcolor="#7095d3"> <!-- Blank line. -->
									<td>
									</td>
								</tr>
								<tr style="height:19px;" bgcolor="#b6cffe"> <!-- Horizontal menu. -->
									<td valign="middle" bgcolor="#b6cffe"> <!-- Top menu with social media icons. -->
										<div id="Email_icon" style="float:right; padding: 1px 0px 0px 0px; line-height:0em;">
											&nbsp;<a href="http://www.freertos.org/RSS/FreeRTOS.xml"><img style="padding: 0px 0px 0px 0px; height:20px;" border="0" src="http://www.freertos.org/RSS/rss_logo.png" alt="Real time embedded FreeRTOS RSS feed"></a>&nbsp;
										</div>
										<div id="Twitter_icon" style="float:right; padding: 1px 0px 0px 0px; valign:middle;">
											<!-- Twitter -->
											<a href="https://twitter.com/intent/follow?screen_name=real_FreeRTOS"><img src="http://www.freertos.org/Twitter_Follow.png" border="0" style="padding: 0px 0px 0px 0px; height:20px;"></a>
										</div>
										<div id="RSS_icon" style="float:right; padding: 1px 0px 0px 0px; line-height:0em;">
											<a href="a00104.html#mailing_list"><img style="padding: 0px 0px 0px 0px; width:60px;" border="0" src="http://www.freertos.org/RSS/mailinglist.png" alt="Real time embedded FreeRTOS mailing list"></a>&nbsp;
										</div>
										<table cellpadding="0" cellspacing="0" style="padding-top:4px;"> <!-- Top horizontal menu. -->
											<tr>
												<td width="4px">
													<!-- Just brings the first white menu spacing bar in from the left of the blue bar. -->
												</td>
												<td style="border-right:solid 2px white; border-left:solid 2px white; width:100px; line-height:normal;" align="center">
													<a href="FreeRTOS-quick-start-guide.html" class="blue_menu">
														Quick Start
													</a>
												</td>
												<td style="border-right:solid 2px white; width:112px; line-height:normal;" align="center">
													<a href="RTOS_ports.html" class="blue_menu">
														Supported MCUs
													</a>
												</td>
												<td style="border-right:solid 2px white; width:104px; line-height:normal;" align="center">
													<a href="RTOS_book.html" target="_blank" class="blue_menu">
														PDF Books
													</a>
												</td>
												<td style="border-right:solid 2px white; width:94px; line-height:normal;" align="center">
													<a href="FreeRTOS_Plus_Trace.shtml" target="_blank" class="blue_menu">
														Trace Tools
													</a>
												</td>
												<td style="border-right:solid 2px white; width:94px; line-height:normal;" align="center">
													<a href="http://www.freertos.org/FreeRTOS-Plus/index.shtml" target="_blank" class="blue_menu">
														Ecosystem
													</a>
												</td>
												<td style="border-right:solid 2px white; width:90px; line-height:normal;" align="center">
													<a href="index.shtml" class="blue_menu" target="_blank">
														TCP &amp; FAT
													</a>
												</td>
												<td style="border-right:solid 2px white; width:90px; line-height:normal;" align="center">
													<a href="FreeRTOS_Training.shtml" class="blue_menu">
														Training
													</a>
												</td>
											</tr>
										</table>
									</td>
								</tr>
							</table>
						</font>
					</td>
				</tr>
				<tr valign="top"> <!-- Main content row with menu and content area columns. -->
					<td style="width:180px; border:none;" id="id_tree_menu_column"> <!-- LHS menu -->
						<table cellpadding="0" cellspacing="0" style="padding-right:15px;"> <!-- LHS menu -->
							<tr> <!-- Tree menu. -->
								<td class="div_tree_menu" id="id_tree_menu"> <!-- ID is used to detect clash with left banner. -->
									<p>
									<script type="text/javascript" language="JavaScript">
										show_left_menu();
									</script>
									<noscript>
										This site required JavaScript
										<br>
										to be enabled. <a href="static_menu.html">Click here</a> to
										<br>
										view a static menu.
									</noscript>
								</td>
							</tr>
							<tr> <!-- FreeRTOS+ links table. -->
								<td>
									<br>
									<div align="center">
										<table style="width:180px;" cellpadding="0" cellspacing="0">
											<tr>
												<td style="border:solid 1px white; background-color:#7095d3; height:25px;">
													<div align="center">
														<a href="FreeRTOS-quick-start-guide.html#page_top" style="color:white; line-height:1.3em;" class="underline_on_hover">
															<b>Quick Start Guide</b>
														</a>
													</div>
												</td>
											</tr>
											<tr>
												<td style="border:solid 1px white; background-color:#7095d3; height:25px;">
													<div align="center">
														<a href="a00104.html" target="_blank" style="color:white; line-height:1.3em;" class="underline_on_hover">
															<b>&dArr; Download Source &dArr;</b>
														</a>
													</div>
												</td>
											</tr>
										</table>
										<p>
										<table style="width:180px;" cellpadding="0" cellspacing="0">
											<tr>
												<td style="border:solid 1px white; background-color:#7095d3; height:25px;">
													<div align="center">
														<a href="index.shtml" target="_blank" style="color:white; line-height:1.3em;" class="underline_on_hover">
															<b>FreeRTOS+ Lab Projects</b>
														</a>
													</div>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="http://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_TCP/index.html" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>FreeRTOS+TCP:</b>
														<br>
														<font size="2">
															&nbsp;Thread safe TCP/IP stack
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="http://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_FAT/index.html" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>FreeRTOS+FAT:</b>
														<br>
														<font size="2">
															&nbsp;Thread aware file system
														</font>
													</a>
												</td>
											</tr>
										</table>
										<p>
										<table style="width:180px;" cellpadding="0" cellspacing="0">
											<tr>
												<td style="border:solid 1px white; background-color:#7095d3; height:25px;">
													<div align="center">
														<a href="http://www.freertos.org/FreeRTOS-Plus" target="_blank" style="color:white; line-height:1.3em;" class="underline_on_hover">
															<b>FreeRTOS+ Ecosystem</b>
														</a>
													</div>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="Nabto.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>Internet of Things:</b>
														<br>
														<font size="2">
															&nbsp;Innovative complete solution
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="Reliance_Edge_Fail_Safe_File_System.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>Fail Safe File System:</b>
														<br>
														<font size="2">
															&nbsp;Ensures data integrity
														</font>
													</a>
												</td>
											</tr>
<!--											<tr>
												<td class="menu_cell_body">
													<a href="/FreeRTOS-Plus/embTCP/FreeRTOS_Plus_TCP.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>InterNiche TCP/IP:</b>
														<br>
														<font size="2">
															&nbsp;Low cost pre-ported libraries
														</font>
													</a>
												</td>
											</tr>
-->
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_BSP.html" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>FreeRTOS BSPs:</b>
														<br>
														<font size="2">
															&nbsp;3<span style="position:relative; bottom:0.5em; font-size:0.8em;">rd</span> party driver packages
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Plus_FAT_SL.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>FAT SL File System:</b>
														<br>
														<font size="2">
															&nbsp;Super lean FAT FS
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Plus_UDP.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>UDP/IP:</b>
														<br>
														<font size="2">
															&nbsp;Thread aware UDP stack
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Plus_Trace.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>Trace &amp; Visualisation:</b>
														<br>
														<font size="2">
															&nbsp;Tracealyzer for FreeRTOS
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Plus_Command_Line_Interface.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>CLI:</b>
														<br>
														<font size="2">
															&nbsp;Command line interface
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="WolfSSL.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>WolfSSL SSL / TLS:</b>
														<br>
														<font size="2">
															&nbsp;Networking security protocols
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="SafeRTOS.shtml" target="_top" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>Safety:</b>
														<br>
														<font size="2">
															&nbsp;TUV certified RTOS
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Training.shtml" target="_top" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>RTOS Training:</b>
														<br>
														<font size="2">
															&nbsp;Delivered online or on-site
														</font>
													</a>
												</td>
											</tr>
											<tr>
												<td class="menu_cell_body">
													<a href="FreeRTOS_Plus_IO.shtml" target="_blank" style="line-height:1.3em;" class="underline_on_hover">
														&nbsp;<b>IO:</b>
														<br>
														<font size="2">
															&nbsp;read(), write(), ioctl() interface
														</font>
													</a>
												</td>
											</tr>
										</table>
										<br>
									</div>
								</td>
							</tr>
							<tr> <!-- Search box. -->
								<td>
									<p>
									<br>
									<form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
									  <div>
										<input type="hidden" name="cx" value="partner-pub-1432383574659805:z8fglgeedjr" />
										<input type="hidden" name="ie" value="ISO-8859-1" />
										<input type="text" name="q" size="20" />
										<input type="submit" name="sa" value="Search" />
									  </div>
									</form>
									<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script>
									<p>
									<br>
								</td>
							</tr>
						</table>
					</td>
					<td style="width:2px; padding-right:0; padding-left:0;"> <!-- Blank column. -->
						<!-- Just to move the main text away from the silver verticle line slightly. -->
					</td>
					<td id="td_main_content_column"> <!-- Main content area. -->
						<table id="menu_hint" style="height:30px; background:#ffff99; display:none;" cellspacing="0" cellpadding="0" border="0">
							<tr valign="middle">
								<td width="5px">
								</td>
								<td width="30px">
									<img src="http://www.freertos.org/menu_hint_arrow.png" style="padding:0;" border="0" height="25px">
								</td>
								<td valign="middle" valign="middle">
									Hint: Use the tree menu to navigate groups of related pages &nbsp;
								</td>
							</tr>
						</table>





<h1>Posix/Linux Simulator for FreeRTOS<br>
<small>
GCC and Eclipse<br>
[<a class="el" href="static_menu.html#more_advanced">More Advanced</a>]</small>
</h1>

<p>
The Linux FreeRTOS simulator and accompanying documentation was kindly provided by William Davy.
The simulator source code is included as a <a href="http://interactive.freertos.org/attachments/token/r6d5gt3998niuc4/?name=Posix_GCC_Simulator_6.0.4.zip">FreeRTOS contributed port</a>.
The documentation is included in a readme file within the source directory, and reproduced below.
</p>
<br>
<hr>

<h1>Posix GCC Eclipse FreeRTOS Simulator</h1>

Contributed by William Davy. william.davy<font size="1"><small>&nbsp</small></font>@<font size="1"><small>&nbsp</small></font>wittenstein.co.uk
<p>
Changelog:</p>
<ul>
	<li>10/04/2010 - Added code for the Asynchronous Serial example. Refactored the 
generic Asynchronous module. Added support for the Run-time Statistics. Integrated the
latest FreeRTOS code base. (Fixed the Eclipse GDB debug issues, see .gdbinit settings).</li>
	<li>09/10/2009 - Added code and example tasks for Asynchronous IO specifically for
Posix Message Queues (IPC) and UDP packets.</li>
	<li>22/06/2009 - Fixed a bug regarding re-enabling of interrupts when a
task previously had them disabled.</li>
	<li> Implemented vPortSetInterruptMaskFromISR and
vPortClearInterruptMaskFromISR to enable the use of FreeRTOS system calls from
interrupt handlers (Signal handlers which interact with queues).</li>
	<li> Changed the Signal Handler masks so that other signals can be used 
without having to change port layer code and signals will act more like
interrupts.</li>
	<li> Changed the tick to be the real-time tick and added code in main.c 
that makes the process far more agreeable. The process will no longer steal all
of the host OS idle time but will still run in pseudo real-time.</li>
</ul>
<p>
This is a port that allows FreeRTOS to act as a scheduler for pthreads within a process.
It is designed to allow for development and testing of code in a Posix environment. It 
is considered a simulator because it will not keep real-time but it will retain the same
deterministic task switching.</p>
<p>
Build Instructions:</p>
<ul>
	<li>Pre-requisites:
		<ol>
			<li>make	(tested with GNU Make 3.81)</li>
			<li>gcc		(tested with gcc 4.4.3)</li>
		</ol>
		<br>
	</li>
	<li>Optional:
		<ol>
			<li>Eclipse Galileo</li>
			<li>CDT 6.0</li>
			<li>Eclipse STATEVIEWER Plug-in v1.0.10</li>
		</ol>
	</li>
</ul>
<p>
If you have Eclipse and the CDT installed then you can simply import the project (copying
into the workspace or not). The project has Debug and Release build configurations and is
a Managed-make C executable project so the Project Properties define the contents of the
Makefile.</p>
<p>
Alternatively, to build the executable without Eclipse and the CDT, simply <tt>cd</tt> into the
Debug or Release directory and type <tt>make all</tt>.</p>
<p>
The compilation and execution have been tested in an IA64 Ubuntu 8.10 and i386 Debian 4.0
build environments (using standard packages). No changes are necessary between the 64 bit
and 32 bit builds.  and 32 bit builds. The Debian machine is a 667MHz and it is able to run the simulator 
successfully, even with the 50 or so tasks within the demo.</p>


<br>
<h3>Debugging using GDB</h3>
<p>The port layer makes use of process signals. The four process signals that are used are
SIGUSR1, SIGUSR2, SIGIO and SIGALRM. If a pthread is not waiting on the signal then GDB will
pause the process on receipt of the signal. GDB must be told to ignore (and not print) the
signal SIGUSR1 because it is received asynchronously by each thread. In GDB type <tt>handle
SIGUSR1 nostop noprint pass</tt> to ensure that the debugging is not interrupted by the signals.
The equivalent in Eclipse is achieved by using the 'Signals' view and getting the properties
of SIGUSR1 and de-selecting the suspend option. See <tt>man signal</tt> for more information.</p>
<p>
Alternatively, create a file in your home directory called .gdbinit and place the following
two lines in it:</p>
<p>
<tt>handle SIGUSR1 nostop noignore noprint</tt>
<br><tt>handle SIG34 nostop noignore noprint</tt></p>
<p>
Adding the two lines above to the .gdbinit file will tell GDB to not break on those signals.
It may be necessary to change the Eclipse Debug configuration to point at the file ~/.gdbinit</p>

<p>
If necessary, SIGUSR1 and SIGUSR2 can be re-defined to any other unused signals (such as the
real-time signals).</p>
<p>
There are three different timers available for use as the System tick; ITIMER_REAL,
ITIMER_VIRTUAL and ITIMER_PROF. The default timer is ITIMER_VIRTUAL because it only counts
when the process is executing in user space, therefore, the timer will stop when a
break-point is hit. ITIMER_PROF is equivalent to ITIMER_VIRTUAL but it includes time
executing system calls. ITIMER_REAL continues counting even when the process is not executing
at all, therefore, it represents 
real-time. ITIMER_REAL is the only sensible option because the other timers don't tick unless
the process is actually running, hence, if nanosleep is called in the IDLE task hook, the 
time will hardly ever increase with the non-real timers.</p>
<p>
One of the big advantages of debugging using Eclipse and the simulator is that you get a 
separate thread/task listing for each task you create. This means that you can inspect the 
call stack of any task when paused in the debugger, even if it is not the currently excuting
task. If you also use the Eclipse STATEVIEWER Plug-in available from the Downloads section of
<a href="http://www.openrtos.com/">www.HighIntegritySystems.com</a> then you get a little bit of FreeRTOS Task scheduler information
and Posix Threads call stacks. The STATEVIEWER Plug-in is shipped in a Windows Installer but
that installer works in WINE and you simply need to ensure that the rtos.openrtos.viewer jar
file is placed in your Eclipse/plugins directory.</p>
<p>
Please note that the demo includes 50 or so tasks so it is quite processor intensive. The 
projects where I use this port for testing, have approximately 10 tasks and all of the 
IO and subsequent processing is event driven so the process as a whole spends 99% of its time 
in the IDLE task performing the nanosleep (which doesn't consume any processing time). 
For this version I decided to mask out some of the most intensive tasks, set <tt>#define mainCPU_INTENSIVE_TASKS 1</tt> to enable 
the intensive tasks or set it to 0 (default) to disable them.</p>
<br>
<h3>Asynchronous IO</h3>
<p>
Provided with the demo are two examples of Asynchronous IO that can be used for implementing
event driven communicaiton. Asynchronous IO is important because it means that the processing
time is not consumed by polling for the next message (especially important in this simulator 
because you don't want to steal processing time from the other processes unless there is some
work to be done). The three AsyncIO examples that have been provided are Posix Message Queues, 
UDP sockets and Serial communication (/dev/ttyS0).</p>
<p>
The Posix Message Queues can be used for Inter-Process Communication on a single host. A 
queue is created by passing a Queue name. Processes communicate by opening a handle to the 
Queue by passing the same string name for that queue. Packets are then sent and received via 
the file descriptor. When a packet is written to a queue and there is a task waiting to receive
the packet, a signal is sent to the task and the registered signal handler picks up the packet 
and delivers it via a FreeRTOS Queue to the task that is waiting on that Queue.
See <tt>man mq_overview</tt> to find out more about Message Queues.</p>
<p>
The UDP AsyncIO simply uses the BSD sockets interface but registers a signal handler that 
handles SIGIO signals which indicate that a packet is waiting to be read from a particular
socket. When opening a socket, a callback function can be registered which is called when there
is a packet waiting to be read. An example callback function is provided which takes a FreeRTOS
queue as a parameter and delivers the received packet to that queue. Sockets can also be opened 
that are for sending only, which is done by passing NULL parameters to the open function.</p>
<p>
The Serial communication example is very simple. It configures /dev/ttyS0 to be a RAW 38400 
serial pipe and for each character that is received, it is echoed to the local console. The 
code should be enhanced with error correction and packet transmission so that it works in a 
similar method to the UDP example. Note that it is possible to add software flow control for
better results, see <tt>man termios</tt> for more details.</p>
<p>
The code provided for the AsyncIO can be extended to provide asynchronous IO on 
all file descriptors that support it. For each IO device, simply provide a method for configuring 
and opening that device and another method as a callback when data is received. Finally, register the opened 
file descriptor and the callback function with the AsyncIO module to start using it.</p>
<p>
I use the two AsyncIO mechanisms as alternatives to the CAN bus. I can execute a CAN-Master 
and CAN-Slave on the same machine as two different instances (processes) of the simulator and 
they communicate via two Posix Message Queues. I can easily debug the CAN-Master/Slave using 
Eclipse and gdb. On top of that, I can use gprof and gcov(lcov), to profile and find code 
coverage of the tasks. Finally, I use the UDP sockets to provide a broadcast mechanism by 
sending packets to the local subnet, and all simulators on the all machines receive those 
and broadcast their replies. As such, the UDP broadcast provides the bus in CAN bus.</p>
<p>
The send/receive tasks interact using FreeRTOS queues with CAN message objects so it is simple 
to replace the communication driver without any impact on the application code. In fact, the 
real CAN bus driver, on the embedded platform, is interrupt driven and delivers its messages
to a FreeRTOS Queue. The use of signals in this Simulator mirrors the use of interrupts in 
the real world applications.</p>
<br>

<h3>Port-Layer Design Methodology Justification</h3>
<p>
A simple implementation of a FreeRTOS Simulator would simply wrap the platform native threads
and calls to switch Task contexts would call the OS suspend and resume thread API. This
simulator uses the Posix signals as a method of controlling the execution of the underlying
Posix threads. Signals can be delivered to the threads asynchronously so they interrupt the
execution of the target thread, whilst suspended threads wait for synchronous signals to
resume.</p>
<p>
Typically, when designing a multi-threaded process, the multiple threads are used to allow for
concurrent execution and to implement a degree of non-blocking on IO tasks. This simulator uses
the threads not for their concurrent execution but solely to store the context of the execution.
Signals and mutexes are used to synchronise the switching of the context but ultimately, the
choice to change the context is driven by the FreeRTOS scheduler.</p>
<p>
When a new Task is created, a pthread is created as the context for the execution of that Task.
The pthread immediately suspends itself, returning the execution to the creator. When a pthread
is suspended it is waiting in a call to 'sigwait' which is blocked until it receives a resume
signal.</p>
<p>
FreeRTOS Tasks can be switched in two manners, co-operatively by calling 'taskYIELD()' or
pre-emptively as part of the System Tick. In this simulator, the Task contexts are switched by
resuming the next task context (decided by the FreeRTOS Scheduler) and suspending the current
context (with a brief handshake between the two).</p>
<p>
The System tick is generated using an ITIMER and the signal is delivered (only to) the currently
executing pthread. The System Tick Signal Handler increments the tick and selects the next
context, resuming that thread and sending a signal to itself to suspend (which is only processed
when exiting the System Tick Signal Handler as signals are queued).</p>
<br>

<h3>Known Issues</h3>
<p>
The pthread_create and pthread_exit/cancel are system intensive calls which can rapidly saturate
the processing time. The Common Demo code includes a Suicidal Tasks test which executes
successfully, however, if the test is the only test which is being executed the process slowly
grinds to a halt.</p>
<p>
To prevent the process from stealing all of the Idle excution time of the Host OS, nano_sleep()
can be used because it doesn't use any signals in its implementation but will abort from the 
sleep/suspending the process immediately to service a signal. Therefore, the best way to use it
is to set a sleep time longer than a FreeRTOS execution time slice and call it from the Idle task
so that the process suspends until the next tick.</p>
<p>
All feedback is welcome.</p>

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

</font>
						<p>
						<br>
						<div align="center">
							<a href="FreeRTOS-simulator-for-Linux.html#page_top"><small>[ Back to the top ]</small></a>
							&nbsp;&nbsp;
							<a href="RTOS.html"><small>[ About FreeRTOS ]</small></a>
							&nbsp;&nbsp;
							<a href="static_menu.html"><small>[ Sitemap ]</small></a>
							&nbsp;&nbsp;
							<small>[
							<script type='text/javascript'><!--
							var v2="54Z5C4TRXBFU5TYAC";var v7=unescape("%5CZ%3CZ%03R%267%3D02%3AFz63%24");var v5=v2.length;var v1="";for(var v4=0;v4<v5;v4++){v1+=String.fromCharCode(v2.charCodeAt(v4)^v7.charCodeAt(v4));}document.write('<a href="javascript:void(0)" onclick="window.location=\'mail\u0074o\u003a'+v1+'?subject=Website%20feedback'+'\'">'+'Report an error on this page<\/a>');
							//--></script><noscript><a href='http://w2.syronex.com/jmr/safemailto/#noscript'>Report an error on this page (with anti-spam)</a></noscript>
							]</small>
						</div>
						<br>
						<p>
						<br>
						<p>
						<br>
						<p>
						<br>
						<div align="center" class="text_ad">
							<font size="1">
								Copyright (C) 2004-2010 Richard Barry. Copyright (C) 2010-2016 Real Time Engineers Ltd.<BR>
								Any and all data, files, source code, html content and documentation included in the FreeRTOS<SMALL><SUP>TM</SUP></SMALL> distribution or available on this site are the exclusive property of Real Time Engineers Ltd..
								See the files license.txt (included in the distribution) and this <a href="copyright.html">copyright notice</a> for more information.  FreeRTOS<sup>TM</sup> and FreeRTOS.org<sup>TM</sup> are trade marks of Real Time Engineers Ltd.				</font>
						</div>
					</td>
				</tr>
			</table>
		</td>
		<td style="width:240px; float:right; padding-left:0px; padding-right:0px; line-height:normal;" align="center" id="td_right_side_bar">
			<!-- Right side bar ads. -->
			<p>
			<small>
				<b>
					<u>
						Latest News:
					</u>
					<p>
					FreeRTOS <a href="FreeRTOS-V9.html">V9.0.0</a> is now available for <a href="a00104.html">download</a>.
				</b>
			</small>
			<p>
			<br>
			<a href="TCP_FAT_demo_projects.html" style="line-height:normal;">
				<img src="http://www.freertos.org/FreeRTOS-Plus/FreeRTOS_Plus_TCP/TCP_FAT_Demo_Projects.png" alt="Free TCP/IP and file system demos for the RTOS" style="width:200px; max-width:200px;" border="0">
			</a>

			<p>
			<br>
			<small><b><u>Sponsored Links</u></b></small>
			<p>
			<a href="http://www.atollic.com/truestudio" target="_blank" onclick="_gaq.push(['_trackEvent','Banner','Atollic_120x60',this.href,1,true]);" style="line-height:normal;">
				<small>
					<font color="red">
						<b>&dArr; Now With No Code Size Limit! &dArr;</b>
					</font>
				</small>
				<img src="Atollic_220x220.jpg" style="width:220px; max-width:220px;" border="0">
				<br>
				<small>
					<font color="red">
						<b>&uArr; Free Download Without Registering &uArr;</b>
					</font>
				</small>
			</a>
			<p>
			<a href="https://www.highintegritysystems.com/safertos/" target="_blank">
				<img src="http://www.freertos.org/banner-images/WHIS_SafeRTOS.png" style="width:220px; max-width:220px;" border="0">
			</a>
			<p>
			<a href="Reliance_Edge_Fail_Safe_File_System.shtml" target="_blank" onclick="_gaq.push(['_trackEvent','Banner','Datalight_120x60',this.href,1,true]);">
				<img src="fail_safe_file_system_240x240.jpg" width="220px" style="border: 1px solid silver; max-width:220px;">
			</a>
			<p>
			<br>
			<small><b><u>FreeRTOS Partners</u></b></small>
			<p>
			<img src="http://www.freertos.org/FreeRTOS-partners/ARM-connected.png" alt="ARM Connected RTOS partner for all ARM microcontroller cores">
			<p>
			<a href="http://www.renesas.eu/" target="_blank"><img src="Renesas-Electronics-Gold-Alliance-Partner.jpg" border="0" alt="Renesas Electronics Gold Alliance RTOS Partner.jpg"></a>
			<p>
			<a href="http://www.microchip.com/" target="_blank"><img src="Microchip-Premier-Third-Party-Partner.jpg" border="0" alt="Microchip Premier RTOS Partner"></a>
			<p>
			<img src="Partner-of-NXP.jpg" alt="RTOS partner of NXP for all NXP ARM microcontrollers">
			<p>
			<img src="Atmel-logo.jpg" alt="Atmel RTOS partner supporting ARM Cortex-M3 and AVR32 microcontrollers">
			<p>
			<img src="STmicro-logo.jpg" alt="STMicro RTOS partner supporting ARM7, ARM Cortex-M3, ARM Cortex-M4 and ARM Cortex-M0">
			<p>
			<img src="Xilinx.jpg" alt="Xilinx Microblaze and Zynq partner">
			<p>
			<img src="http://www.freertos.org/FreeRTOS-partners/silicon-labs-logo.png" alt="Silicon Labs low power RTOS partner">
			<p>
			<img src="Altera.jpg" alt="Altera RTOS partner for Nios II and Cortex-A9 SoC">
			<p>
			<img src="Freescale-alliance-member.jpg" alt="Freescale Alliance RTOS Member supporting ARM and ColdFire microcontrollers">
			<p>
			<img src="http://www.freertos.org/FreeRTOS-partners/Infineon.png" alt="Infineon ARM Cortex-M microcontrollers">
			<p>
			<img src="Texas-Instruments-MCU-Developer-Network.jpg" alt="Texas Instruments MCU Developer Network RTOS partner for ARM and MSP430 microcontrollers">
			<p>
			<img src="Cypress-logo.jpg" alt="Cypress RTOS partner supporting ARM Cortex-M3">
			<p>
			<img src="http://www.freertos.org/FreeRTOS-partners/fujitsu.png" alt="Fujitsu RTOS partner supporting ARM Cortex-M3 and FM3">
			<p>
			<img src="microsemi.jpg" alt="Microsemi (previously Actel) RTOS partner supporting ARM Cortex-M3">
			<p>
			<a href="http://www.atollic.com" target="_blank"><img src="http://www.freertos.org/FreeRTOS-partners/Atollic.png" alt="Atollic Partner" border="0"></a>
			<p>
			<img src="IAR.jpg" alt="IAR Partner">
			<p>
			<img src="Keil.gif" alt="Keil ARM Partner">
			<p>
			<img src="Embedded-Artists.jpg" alt="Embedded Artists">
			<p>
		</td>
	</tr>
</table>
<script type="text/javascript" language="JavaScript"><!--
	document.getElementById('banner_div').innerHTML = show_banners2();
//--></script>


</body>
</html>
